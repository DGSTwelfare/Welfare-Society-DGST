<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DGST Office Welfare Society - Monthly Tracking System v3.5 Secure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .retired-row {
            background-color: #fff3cd !important;
            border-left: 4px solid #f39c12;
        }
        
        .retiring-soon-row {
            background-color: #ffeaa7 !important;
            border-left: 4px solid #e67e22;
        }
        
        .paid-row {
            background-color: #d5f4e6 !important;
            border-left: 4px solid #2ecc71;
        }
        
        .pending-row {
            background-color: #fadbd8 !important;
            border-left: 4px solid #e74c3c;
        }
        
        .advance-row {
            background-color: #d6eaf8 !important;
            border-left: 4px solid #3498db;
        }
        
        .deleted-row {
            background-color: #f5f5f5 !important;
            border-left: 4px solid #95a5a6;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .parked-row {
            background-color: #e0e0e0 !important;
            border-left: 4px solid #9e9e9e;
            opacity: 0.8;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-active { background: #d4edda; color: #155724; }
        .status-retired { background: #f8d7da; color: #721c24; }
        .status-retiring { background: #fff3cd; color: #856404; }
        .status-pending { background: #f8d7da; color: #721c24; }
        .status-paid { background: #d4edda; color: #155724; }
        .status-advance { background: #cce5ff; color: #004085; }
        .status-deleted { background: #e0e0e0; color: #666; }
        .status-parked { background: #e2e3e5; color: #383d41; }
        
        /* Hover Effects */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white !important;
            }
            
            .print-table {
                border-collapse: collapse;
                width: 100%;
                font-size: 12px;
            }
            
            .print-table th, .print-table td {
                border: 1px solid #000;
                padding: 6px;
            }
            
            .print-table th {
                background-color: #f0f0f0 !important;
                color: #000 !important;
            }
            
            .receipt-print {
                border: 2px solid #000 !important;
                padding: 20px !important;
                margin: 20px !important;
            }
        }
        
        /* Payment Button Animation */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        
        /* Tab Styles */
        .tab-btn {
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
        }
        
        /* Inline Edit Styles */
        .editable-cell {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .editable-cell:hover {
            background-color: #fef3c7;
        }
        
        /* Animation for save */
        @keyframes highlightSave {
            0% { background-color: rgba(34, 197, 94, 0.3); }
            100% { background-color: transparent; }
        }
        
        .save-highlight {
            animation: highlightSave 1s ease-in-out;
        }
        
        /* Undo Toast */
        .undo-toast {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* Read-only styles */
        .read-only {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .read-only input,
        .read-only select,
        .read-only textarea,
        .read-only button {
            pointer-events: none;
            opacity: 0.6;
        }
        
        .admin-only {
            /* Admin-only elements will be hidden for viewers */
        }
        
        .viewer-hide {
            /* Elements to hide from viewers */
        }
        
        .role-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .role-admin {
            background: #3b82f6;
            color: white;
        }
        
        .role-viewer {
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center z-50 fade-in">
        <div class="glass-card rounded-2xl p-8 w-96 max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-r from-orange-500 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-building text-white text-3xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-800">DGST Welfare Society</h2>
                <p class="text-gray-600 mt-2">Monthly Tracking System v3.5 Secure</p>
                <div class="mt-4 text-sm text-gray-500">
                    <p><i class="fas fa-users mr-2"></i> 120 Members | <i class="fas fa-rupee-sign mr-2"></i> Monthly ₹100</p>
                    <p><i class="fas fa-shield-alt mr-2"></i> Secure Role-Based Access</p>
                    <!-- Password hints removed for security -->
                </div>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-key mr-2"></i>Enter Password
                    </label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="passwordInput" 
                            placeholder="Enter password to access system"
                            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none transition-all pl-12"
                            autocomplete="off"
                        />
                        <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <button 
                            id="togglePassword"
                            type="button"
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-blue-500"
                        >
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button 
                    id="loginBtn"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-3"
                >
                    <i class="fas fa-sign-in-alt"></i>
                    Login to Dashboard
                </button>
                
                <div id="errorMsg" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <span id="errorText">Incorrect password! Try again.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-700 to-purple-800 text-white shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-building text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold">DGST Welfare Society</h1>
                            <p class="text-blue-200 text-sm">Monthly Tracking System v3.5 Secure | 
                                <span id="userRoleBadge" class="ml-2 px-2 py-1 rounded text-xs"></span>
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <div class="hidden md:block text-right">
                            <p class="text-sm text-blue-200" id="currentDateTime"></p>
                            <p class="text-sm font-semibold" id="userRole">View Only Mode</p>
                        </div>
                        
                        <!-- Settings Dropdown Menu -->
                        <div class="relative">
                            <button 
                                id="userMenuBtn"
                                class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-6 py-3 rounded-xl font-semibold transition-all flex items-center gap-2"
                            >
                                <i class="fas fa-user-circle"></i>
                                <span id="userRoleText">User</span>
                                <i class="fas fa-chevron-down ml-2 text-sm"></i>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg z-50 border border-gray-200">
                                <div class="p-4 border-b">
                                    <p class="font-semibold text-gray-800" id="dropdownUserName">System User</p>
                                    <p class="text-sm text-gray-600" id="dropdownUserRole">DGST Welfare Society</p>
                                </div>
                                <div class="py-2">
                                    <button 
                                        id="changePasswordBtn"
                                        class="w-full text-left px-4 py-3 hover:bg-blue-50 text-gray-700 flex items-center gap-2"
                                    >
                                        <i class="fas fa-key text-blue-600"></i>
                                        Change Password
                                    </button>
                                    <button 
                                        id="settingsBtn"
                                        class="w-full text-left px-4 py-3 hover:bg-blue-50 text-gray-700 flex items-center gap-2"
                                    >
                                        <i class="fas fa-cog text-gray-600"></i>
                                        Settings
                                    </button>
                                    <div class="border-t my-2"></div>
                                    <button 
                                        onclick="logout()"
                                        class="w-full text-left px-4 py-3 hover:bg-red-50 text-red-600 flex items-center gap-2"
                                    >
                                        <i class="fas fa-sign-out-alt"></i>
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Current Month Info -->
            <div class="glass-card rounded-2xl p-6 mb-8 bg-gradient-to-r from-blue-50 to-cyan-50 border-2 border-blue-200">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-calendar-alt mr-3 text-blue-600"></i>
                            <span id="currentMonthYear">December 2025</span>
                        </h2>
                        <p class="text-gray-600 mt-1">Monthly Tracking System Active - <span id="accessMode">View Only</span></p>
                    </div>
                    <div class="flex flex-wrap gap-4">
                        <!-- Current Month Receivable -->
                        <div class="text-center">
                            <div class="text-lg font-bold text-blue-700" id="currentMonthReceivable">₹0</div>
                            <div class="text-sm text-blue-600">Current Month Receivable</div>
                        </div>
                        
                        <!-- Current Month Received -->
                        <div class="text-center">
                            <div class="text-lg font-bold text-green-700" id="currentMonthReceived">₹0</div>
                            <div class="text-sm text-green-600">Current Month Received</div>
                        </div>
                        
                        <!-- Current Month Withdrawn -->
                        <div class="text-center">
                            <div class="text-lg font-bold text-red-700" id="currentMonthWithdrawn">₹0</div>
                            <div class="text-sm text-red-600">Current Month Withdrawn</div>
                        </div>
                        
                        <!-- Current Balance -->
                        <div class="text-center">
                            <div class="text-lg font-bold text-purple-700" id="currentBalance">₹0</div>
                            <div class="text-sm text-purple-600">Current Balance</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Members -->
                <div class="glass-card rounded-2xl p-6 hover-lift">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-600 text-sm font-semibold">Total Members</p>
                            <p class="text-3xl font-bold text-gray-800 mt-2" id="totalMembers">120</p>
                        </div>
                        <div class="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-users text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <button 
                            onclick="showAllMembersView()"
                            class="text-blue-600 hover:text-blue-800 text-sm font-semibold flex items-center gap-2"
                        >
                            View All Members <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Current Month Receivable -->
                <div class="glass-card rounded-2xl p-6 hover-lift">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-600 text-sm font-semibold">Current Month Receivable</p>
                            <p class="text-3xl font-bold text-blue-700 mt-2" id="totalReceivable">₹12,000</p>
                        </div>
                        <div class="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-money-bill-wave text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        <p>Monthly ₹100 per member</p>
                    </div>
                </div>

                <!-- Current Month Received -->
                <div class="glass-card rounded-2xl p-6 hover-lift">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-600 text-sm font-semibold">Current Month Received</p>
                            <p class="text-3xl font-bold text-purple-700 mt-2" id="totalReceived">₹0</p>
                        </div>
                        <div class="w-14 h-14 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-hand-holding-usd text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="collectionProgress" class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Pending Members -->
                <div class="glass-card rounded-2xl p-6 hover-lift">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-600 text-sm font-semibold">Pending Payments</p>
                            <p class="text-3xl font-bold text-red-700 mt-2" id="pendingMembers">120</p>
                        </div>
                        <div class="w-14 h-14 bg-red-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-clock text-red-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <button 
                            onclick="showQuickPaymentModal()"
                            class="text-red-600 hover:text-red-800 text-sm font-semibold flex items-center gap-2 admin-only"
                        >
                            <i class="fas fa-plus-circle"></i> Quick Add Payment
                        </button>
                        <button 
                            onclick="showPendingPayments()"
                            class="text-red-600 hover:text-red-800 text-sm font-semibold flex items-center gap-2"
                        >
                            <i class="fas fa-list"></i> View Pending
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Add Payment (Admin Only) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer pulse bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 admin-only" onclick="showQuickPaymentModal()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-money-bill-wave text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Add Payment</h3>
                            <p class="text-sm text-gray-600">Record member payment</p>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-green-600 font-semibold">
                        <i class="fas fa-bolt mr-1"></i> Admin Only
                    </div>
                </div>

                <!-- Add Member (Admin Only) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer admin-only" onclick="showAddMemberModal()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-user-plus text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Add New Member</h3>
                            <p class="text-sm text-gray-600">Register new society member</p>
                        </div>
                    </div>
                </div>

                <!-- All Members (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showAllMembersView()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-users text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">All Members</h3>
                            <p class="text-sm text-gray-600">View complete member list</p>
                        </div>
                    </div>
                </div>

                <!-- Monthly Report (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showMonthlyReport()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-teal-500 to-cyan-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-calendar-alt text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Monthly Report</h3>
                            <p class="text-sm text-gray-600">View month-wise collections</p>
                        </div>
                    </div>
                </div>

                <!-- WhatsApp (Admin Only) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer admin-only" onclick="showMessagingPanel()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-600 to-teal-600 rounded-xl flex items-center justify-center">
                            <i class="fab fa-whatsapp text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">WhatsApp Messaging</h3>
                            <p class="text-sm text-gray-600">Send bulk messages/reminders</p>
                        </div>
                    </div>
                </div>
                
                <!-- Edit Members (Admin Only) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer admin-only" onclick="showAllMembersEdit()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-user-edit text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Edit Members</h3>
                            <p class="text-sm text-gray-600">Edit member details and payments</p>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Reports (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showPaymentReports()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-orange-500 to-red-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-file-invoice-dollar text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Payment Reports</h3>
                            <p class="text-sm text-gray-600">View all payment history</p>
                        </div>
                    </div>
                </div>
                
                <!-- Pending Members (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showPendingPayments()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Pending Payments</h3>
                            <p class="text-sm text-gray-600">View pending dues list</p>
                        </div>
                    </div>
                </div>

                <!-- Excel Data Export Button (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showExcelExportOptions()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-teal-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-file-excel text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Excel Data Export</h3>
                            <p class="text-sm text-gray-600">Export all data to Excel</p>
                        </div>
                    </div>
                </div>

                <!-- Parked Members View (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showParkedMembers()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-gray-500 to-gray-700 rounded-xl flex items-center justify-center">
                            <i class="fas fa-parking text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Parked Members</h3>
                            <p class="text-sm text-gray-600">Non-contributing members</p>
                        </div>
                    </div>
                </div>

                <!-- Retired Members Details (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showRetiredMembersDetails()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-orange-500 to-amber-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-user-clock text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Retired Members</h3>
                            <p class="text-sm text-gray-600">Detailed retired members list</p>
                        </div>
                    </div>
                </div>

                <!-- JSON Export Button (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="exportDataForEmail()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-teal-500 to-green-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-file-export text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">डेटा बैकअप</h3>
                            <p class="text-sm text-gray-600">JSON फ़ाइल डाउनलोड करें</p>
                        </div>
                    </div>
                </div>

                <!-- Main Account Withdrawal Button (Admin Only) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer admin-only" onclick="showMainAccountWithdrawalModal()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-amber-500 to-orange-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-university text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Main Account Withdrawal</h3>
                            <p class="text-sm text-gray-600">Society account से निकासी</p>
                        </div>
                    </div>
                </div>

                <!-- Withdrawal Reports (All Users) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer" onclick="showWithdrawalReports()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-pink-500 to-rose-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-file-invoice text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Withdrawal Reports</h3>
                            <p class="text-sm text-gray-600">View all withdrawals</p>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Reset Data Button (Admin Only) -->
                <div class="glass-card rounded-2xl p-6 hover-lift cursor-pointer admin-only" onclick="showResetDataModal()">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-redo text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Reset Data</h3>
                            <p class="text-sm text-gray-600">Secure reset with backup & restore</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Payments -->
            <div class="glass-card rounded-2xl p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-gray-800 text-xl">
                        <i class="fas fa-history mr-3"></i>Recent Payments
                    </h3>
                    <button 
                        onclick="showPaymentReports()"
                        class="text-blue-600 hover:text-blue-800 text-sm font-semibold flex items-center gap-2"
                    >
                        View All <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="space-y-3 max-h-60 overflow-y-auto" id="recentPayments">
                    <div class="text-center py-4 text-gray-400">
                        <i class="fas fa-circle-notch fa-spin text-xl"></i>
                        <p class="mt-2">Loading payment history...</p>
                    </div>
                </div>
            </div>

            <!-- Recent Withdrawals -->
            <div class="glass-card rounded-2xl p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-gray-800 text-xl">
                        <i class="fas fa-money-check-alt mr-3"></i>Recent Withdrawals
                    </h3>
                    <button 
                        onclick="showWithdrawalReports()"
                        class="text-red-600 hover:text-red-800 text-sm font-semibold flex items-center gap-2"
                    >
                        View All <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="space-y-3 max-h-60 overflow-y-auto" id="recentWithdrawals">
                    <div class="text-center py-4 text-gray-400">
                        <i class="fas fa-circle-notch fa-spin text-xl"></i>
                        <p class="mt-2">Loading withdrawal history...</p>
                    </div>
                </div>
            </div>

            <!-- Member Categories -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Designation Breakdown -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="font-bold text-gray-800 text-xl mb-6">
                        <i class="fas fa-briefcase mr-3"></i>Designation Breakdown
                    </h3>
                    
                    <div class="space-y-4 max-h-80 overflow-y-auto">
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-tie text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-blue-800">Assistant</p>
                                    <p class="text-xs text-blue-600">Multiple departments</p>
                                </div>
                            </div>
                            <span class="font-bold text-2xl text-blue-600" id="assistantCount">0</span>
                        </div>

                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-file-invoice-dollar text-green-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-green-800">Accountant/Auditor</p>
                                    <p class="text-xs text-green-600">Finance department</p>
                                </div>
                            </div>
                            <span class="font-bold text-2xl text-green-600" id="accountantCount">0</span>
                        </div>

                        <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-cog text-purple-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-purple-800">Clerk/Steno</p>
                                    <p class="text-xs text-purple-600">Administrative staff</p>
                                </div>
                            </div>
                            <span class="font-bold text-2xl text-purple-600" id="clerkCount">0</span>
                        </div>

                        <div class="flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-hands-helping text-orange-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-orange-800">Peon/Driver</p>
                                    <p class="text-xs text-orange-600">Support staff</p>
                                </div>
                            </div>
                            <span class="font-bold text-2xl text-orange-600" id="peonCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Statistics -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="font-bold text-gray-800 text-xl mb-6">
                        <i class="fas fa-chart-pie mr-3"></i>Quick Statistics
                    </h3>
                    
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-700">Monthly Collection Potential</span>
                                <span class="font-bold" id="monthlyPotential">₹12,000</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div id="monthlyProgress" class="bg-green-500 h-3 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-700">Retirement Status</span>
                                <span class="font-bold" id="retirementStatus">0 Retiring</span>
                            </div>
                            <div class="grid grid-cols-3 gap-2 text-center text-xs mb-3">
                                <div class="bg-green-100 text-green-800 p-2 rounded cursor-pointer hover:bg-green-200" 
                                     onclick="showRetirementDetails('active')" title="Click to view active members">
                                    <div id="activeCount">0</div>
                                    <div class="text-xs">Active</div>
                                </div>
                                <div class="bg-yellow-100 text-yellow-800 p-2 rounded cursor-pointer hover:bg-yellow-200" 
                                     onclick="showRetirementDetails('retiring-soon')" title="Click to view retiring soon members">
                                    <div id="retiringSoonCount">0</div>
                                    <div class="text-xs">Soon</div>
                                </div>
                                <div class="bg-red-100 text-red-800 p-2 rounded cursor-pointer hover:bg-red-200" 
                                     onclick="showRetirementDetails('retired')" title="Click to view retired members">
                                    <div id="retiredCount">0</div>
                                    <div class="text-xs">Retired</div>
                                </div>
                            </div>
                            
                            <!-- Retiring Soon Details -->
                            <div id="retiringSoonDetails" class="mt-4 hidden">
                                <h4 class="font-semibold text-yellow-800 mb-2 text-sm">
                                    <i class="fas fa-clock mr-1"></i> Retiring Soon Members
                                </h4>
                                <div class="max-h-32 overflow-y-auto border border-yellow-200 rounded-lg p-2" id="retiringSoonList">
                                    <!-- Dynamic content will be added here -->
                                </div>
                            </div>
                            
                            <!-- Retired Details -->
                            <div id="retiredDetails" class="mt-4 hidden">
                                <h4 class="font-semibold text-red-800 mb-2 text-sm">
                                    <i class="fas fa-user-clock mr-1"></i> Retired Members
                                </h4>
                                <div class="max-h-32 overflow-y-auto border border-red-200 rounded-lg p-2" id="retiredList">
                                    <!-- Dynamic content will be added here -->
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">System Info</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Members:</span>
                                    <span class="font-semibold" id="totalMembersCount">120</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Monthly Fee:</span>
                                    <span class="font-semibold">₹100</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">With Phone:</span>
                                    <span class="font-semibold" id="withPhoneCount">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Data Updated:</span>
                                    <span class="font-semibold" id="lastUpdated">Just now</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6 mt-12">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <h3 class="text-xl font-bold">DGST Welfare Society</h3>
                        <p class="text-gray-400 text-sm">120 Members | Version 3.5 - Secure Role-Based Access</p>
                        <p class="text-gray-400 text-xs mt-1" id="footerRoleInfo">Logged in as: <span id="footerRole">Viewer</span></p>
                    </div>
                    <div class="text-center md:text-right">
                        <p class="text-gray-400 text-sm">
                            <i class="fas fa-calendar-alt mr-1"></i> 
                            Current Month: <span id="currentMonthYearFooter">December 2025</span>
                        </p>
                        <p class="text-gray-400 text-sm mt-1">
                            <i class="fas fa-database mr-1"></i> 
                            Monthly Tracking | Auto Backup | Secure Access
                        </p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal Container -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden fade-in">
            <div class="p-6 border-b flex justify-between items-center bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                <h3 class="text-xl font-bold" id="modalTitle">Modal Title</h3>
                <button onclick="closeModal()" class="text-white hover:text-gray-200 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-80px)]" id="modalContent">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-xl shadow-lg z-50 max-w-md">
        <div class="flex items-center gap-3">
            <i class="fas fa-check-circle text-green-400" id="toastIcon"></i>
            <div>
                <p class="font-semibold" id="toastTitle">Success</p>
                <p class="text-sm text-gray-300" id="toastMessage">Operation completed successfully</p>
            </div>
        </div>
    </div>

    <script>
        // ====================
        // CONFIGURATION - UPDATED FOR SECURE ACCESS
        // ====================
        const CONFIG = {
            ADMIN_PASSWORD: '4066',
            VIEWER_PASSWORD: '6633',
            MONTHLY_CONTRIBUTION: 100,
            VERSION: '3.5 - Secure Role-Based Access',
            EMAIL_TO: 'mkm406633@gmail.com',
            SECURITY_QUESTIONS: [
                'What is your mother\'s maiden name?',
                'What was the name of your first pet?',
                'What is the name of the city where you were born?'
            ],
            SECURITY_ANSWERS: ['answer1', 'answer2', 'answer3']
        };

        // पासवर्ड स्टोरेज कीज
        const PASSWORD_KEYS = {
            ADMIN: 'dgst_admin_password_v3_5_secure',
            VIEWER: 'dgst_viewer_password_v3_5_secure'
        };

        // डेटा स्टोरेज की
        const DATA_KEY = 'dgst_welfare_complete_v3_5_secure_' + Math.random().toString(36).substring(2, 15);

        // ====================
        // GLOBAL VARIABLES - UPDATED
        // ====================
        let currentUser = null;
        let currentUserRole = 'guest'; // 'admin', 'viewer', 'guest'
        let employees = [];
        let payments = [];
        let withdrawals = [];
        let activities = [];
        let receiptCounter = 1000;
        let withdrawalReceiptCounter = 2000;

        // ====================
        // PASSWORD MANAGEMENT FUNCTIONS
        // ====================
        function loadPasswords() {
            const savedAdminPass = localStorage.getItem(PASSWORD_KEYS.ADMIN);
            const savedViewerPass = localStorage.getItem(PASSWORD_KEYS.VIEWER);
            
            // CONFIG में असाइन करें
            if (savedAdminPass && savedAdminPass.trim() !== '') {
                CONFIG.ADMIN_PASSWORD = savedAdminPass;
            }
            
            if (savedViewerPass && savedViewerPass.trim() !== '') {
                CONFIG.VIEWER_PASSWORD = savedViewerPass;
            }
        }

        function savePasswords(adminPass, viewerPass) {
            try {
                if (adminPass && adminPass.trim() !== '') {
                    CONFIG.ADMIN_PASSWORD = adminPass;
                    localStorage.setItem(PASSWORD_KEYS.ADMIN, adminPass);
                }
                
                if (viewerPass && viewerPass.trim() !== '') {
                    CONFIG.VIEWER_PASSWORD = viewerPass;
                    localStorage.setItem(PASSWORD_KEYS.VIEWER, viewerPass);
                }
                
                return true;
            } catch (error) {
                console.error('Error saving passwords:', error);
                return false;
            }
        }

        // ====================
        // PERMISSION CHECK FUNCTIONS
        // ====================
        function checkAdminPermission() {
            if (currentUserRole !== 'admin') {
                showToast('Access Denied', 'Only administrators can perform this action', 'error');
                return false;
            }
            return true;
        }

        function checkViewerPermission() {
            if (currentUserRole === 'guest') {
                showToast('Access Denied', 'Please login to access this feature', 'error');
                return false;
            }
            return true;
        }

        // ====================
        // USER INTERFACE FUNCTIONS
        // ====================
        function updateUserInterface() {
            // Update role indicators
            const roleBadge = document.getElementById('userRoleBadge');
            const accessMode = document.getElementById('accessMode');
            const footerRole = document.getElementById('footerRole');
            const footerRoleInfo = document.getElementById('footerRoleInfo');
            
            if (currentUserRole === 'admin') {
                roleBadge.textContent = 'Admin Mode';
                roleBadge.className = 'px-2 py-1 rounded text-xs bg-red-500 text-white';
                accessMode.textContent = 'Admin Mode (Full Access)';
                footerRole.textContent = 'Administrator';
                footerRoleInfo.classList.remove('hidden');
                
                // Show all admin-only elements
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.classList.remove('hidden');
                });
                
                // Enable all inputs
                document.querySelectorAll('input, select, textarea, button').forEach(el => {
                    el.removeAttribute('readonly');
                    el.removeAttribute('disabled');
                });
                
            } else if (currentUserRole === 'viewer') {
                roleBadge.textContent = 'View Only';
                roleBadge.className = 'px-2 py-1 rounded text-xs bg-green-500 text-white';
                accessMode.textContent = 'View Only Mode (Read Only)';
                footerRole.textContent = 'Viewer';
                footerRoleInfo.classList.remove('hidden');
                
                // Hide admin-only elements
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Disable all inputs in modals (they will be handled when modals open)
            } else {
                roleBadge.textContent = 'Guest';
                roleBadge.className = 'px-2 py-1 rounded text-xs bg-gray-500 text-white';
                accessMode.textContent = 'Not Logged In';
                footerRoleInfo.classList.add('hidden');
            }
        }

        // ====================
        // All Designations including Other
        // ====================
        const ALL_DESIGNATIONS = [
            'Assistant',
            'Clerk',
            'Peon',
            'Driver',
            'Accountant',
            'Junior Auditor',
            'Steno Typist',
            'DEO',
            'DECO',
            'Superintendent',
            'Deputy Superintendent',
            'Helper',
            'PA',
            'Steno Typsi',
            'SSS',
            'JSS',
            'DTC',
            'DECO',
            'Other'
        ];

        // Expense Categories
        const EXPENSE_CATEGORIES = [
            '👔 Uniform & Clothing',
            '👔 Safari Suit',
            '👔 Blanket',
            '👔 Pagdi',
            '🎉 Functions & Events',
            '🎉 Sweets',
            '🎉 Cold Drinks',
            '🎉 Tea',
            '🎉 Coffee',
            '🎉 Phool Malas',
            '🏆 Awards & Recognition',
            '🏆 Momento',
            '🏆 Disposal Glass',
            '🏢 General Categories',
            '🏢 Office',
            '🏢 Event',
            '🏢 Maintenance',
            '🏢 Other'
        ];

        // ====================
        // DEFAULT EMPLOYEES DATA - ALL 120 MEMBERS (UPDATED)
        // ====================
        const DEFAULT_EMPLOYEES = [
            {id: 1, name: 'Ajay', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 2, name: 'Aman', designation: 'DEO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 3, name: 'Amit', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 4, name: 'Amit', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 5, name: 'Amitk Singh', designation: 'Driver', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 6, name: 'Anil', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 7, name: 'Anil', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 8, name: 'Anil', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 9, name: 'Anil', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 10, name: 'Anoop Singh', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 11, name: 'Anuj Kundu', designation: 'Junior Auditor', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 12, name: 'Arun', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 13, name: 'Ashwini', designation: 'Assistant', phone: '8930910419', joinDate: '2026-01-01', retirementDate: '2054-04-30', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 14, name: 'Babia Sharma', designation: 'PA', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 15, name: 'Baljit', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 16, name: 'Balkar', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 17, name: 'Banty', designation: 'Steno Typsi', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 18, name: 'Bharat', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 19, name: 'Bharat Soni', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 20, name: 'Bijender', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 21, name: 'Bijender Hooda', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 22, name: 'Chand Singh', designation: 'Helper', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 23, name: 'Charan Das', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 24, name: 'Dalpat', designation: 'Deputy Superintendent', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 25, name: 'Darshan Walia', designation: 'Deputy Superintendent', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 26, name: 'Deepak', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 27, name: 'Devender', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 28, name: 'Dilawar', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 29, name: 'Dinesh', designation: 'Assistant', phone: '9041802020', joinDate: '2026-01-01', retirementDate: '2052-01-31', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 30, name: 'Geelu Rani', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 31, name: 'Gogi', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 32, name: 'Jagbir', designation: 'Accountant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 33, name: 'Jaideep', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 34, name: 'Jain', designation: 'DECO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 35, name: 'Jasvir Kaur', designation: 'DECO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 36, name: 'JatindarPal', designation: 'Deputy Superintendent', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 37, name: 'Kamal Preet', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 38, name: 'Karam Singh', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 39, name: 'Karamveer', designation: 'Driver', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 40, name: 'Khem', designation: 'Driver', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 41, name: 'Kudeep', designation: 'Driver', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 42, name: 'Kuldsep', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 43, name: 'Manisha', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 44, name: 'Manmohan', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 45, name: 'Manoj Kumar', designation: 'Accountant', phone: '', joinDate: '2026-01-01', retirementDate: '2045-07-31', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 46, name: 'Manoj Kumar', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 47, name: 'Meenakshi Rani', designation: 'Steno Typsi', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 48, name: 'Mohit', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 49, name: 'Monu', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 50, name: 'Mulesh', designation: 'DECO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 51, name: 'Munish', designation: 'Steno Typist', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 52, name: 'Muniya', designation: 'DEO', phone: '', joinDate: '2025-12-09', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 53, name: 'Naresh Goyal', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 54, name: 'Naveen', designation: 'DEO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 55, name: 'Neelam', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 56, name: 'Neeraj', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 57, name: 'Nirmal', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 58, name: 'Pardeep Nazar', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 59, name: 'Pardeep Pannu', designation: 'DEO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 60, name: 'Pardeep Phogat', designation: 'DECO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 61, name: 'Parmila', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 62, name: 'Parmila', designation: 'DEO', phone: '', joinDate: '2025-12-09', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 63, name: 'Parvesh', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 64, name: 'Pavlinder', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 65, name: 'Pavlt', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 66, name: 'Pawan', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 67, name: 'Pawan', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 68, name: 'Pawan Farsa', designation: 'Steno Typsi', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 69, name: 'Rahul', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 70, name: 'Raj Kumar', designation: 'Steno Typist', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 71, name: 'Rajeev', designation: 'Steno Typist', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 72, name: 'Rajesh', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 73, name: 'Rajesh Yadav', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 74, name: 'Rakesh', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 75, name: 'Rakesh Lambu', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 76, name: 'Ram Bahadur', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 77, name: 'Raman', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 78, name: 'Ramesh', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 79, name: 'Ranjana Sharma', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 80, name: 'Ravinder Kumar', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 81, name: 'Ravinder Mohan', designation: 'DEO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 82, name: 'Renu', designation: 'Assistant', phone: '9478753181', joinDate: '2026-01-01', retirementDate: '2034-03-31', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 83, name: 'Rohit', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 84, name: 'Rohtas', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 85, name: 'Sakuntla', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '2025-12-31', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: true, parked: false, status: 'retired'},
            {id: 86, name: 'Sandesp', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 87, name: 'Sanjay', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 88, name: 'Sanjay', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 89, name: 'Sanjeev', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 90, name: 'Saqib', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 91, name: 'Sarbjit Singh Mann', designation: 'DTC', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 92, name: 'Sarwjeet Kaur', designation: 'Superintendent', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 93, name: 'Satish', designation: 'Accountant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 94, name: 'Satish Jangra', designation: 'SSS', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 95, name: 'Shallender Singh', designation: 'A/C', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 96, name: 'Shalu', designation: 'Steno Typist', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 97, name: 'Shamarta', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 98, name: 'Shri Bhagwan', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 99, name: 'Shukhwinder Kaur', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 100, name: 'Soma', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 101, name: 'Sombir Rana', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 102, name: 'SP Parmar', designation: 'JSS', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 103, name: 'Sudha Rani', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 104, name: 'Suman', designation: 'Accountant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 105, name: 'Suman', designation: 'DECO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 106, name: 'Suman Sawroop', designation: 'DECO', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 107, name: 'Sunil Hooda', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 108, name: 'Sunita', designation: 'Superintendent', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 109, name: 'Surender', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 110, name: 'Sushil', designation: 'Clerk', phone: '9053919108', joinDate: '2026-01-01', retirementDate: '2049-04-30', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 111, name: 'Sushil', designation: 'Peon', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 112, name: 'Sushma', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 113, name: 'Upasana', designation: 'DEO', phone: '', joinDate: '2025-12-09', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 114, name: 'Urmila', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 115, name: 'Vijay', designation: 'Driver', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 116, name: 'Vikas Gujjar', designation: 'Junior Auditor', phone: '9915319516', joinDate: '2026-01-01', retirementDate: '2048-10-31', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 117, name: 'Vikash', designation: 'Clerk', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 118, name: 'Vikash Choudhary', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 119, name: 'Vinod Kumar', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'},
            {id: 120, name: 'Vinod Kumar', designation: 'Assistant', phone: '', joinDate: '2026-01-01', retirementDate: '', 
             monthlyReceivable: 100, totalReceived: 0, currentMonthReceivable: 100, lastUpdatedMonth: '', deleted: false, parked: false, status: 'active'}
        ];

        // ====================
        // UTILITY FUNCTIONS
        // ====================
        function getCurrentMonthYear() {
            const now = new Date();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            return `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
        }

        function showToast(title, message, type = 'success') {
            const iconMap = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            const colorMap = {
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400',
                info: 'text-blue-400'
            };
            
            document.getElementById('toastIcon').className = `fas ${iconMap[type]} ${colorMap[type]}`;
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = message;
            
            const toast = document.getElementById('toast');
            toast.classList.remove('hidden');
            toast.classList.add('undo-toast');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        function formatCurrency(amount) {
            return '₹' + amount.toLocaleString('en-IN');
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        // ====================
        // MODAL FUNCTIONS WITH PERMISSION CHECK
        // ====================
        function showModal(title, content, isAdminOnly = false) {
            if (isAdminOnly && !checkAdminPermission()) {
                return;
            }
            
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // If viewer, disable all inputs in modal
            if (currentUserRole === 'viewer') {
                setTimeout(() => {
                    const modalInputs = document.querySelectorAll('#modalContent input, #modalContent select, #modalContent textarea, #modalContent button');
                    modalInputs.forEach(el => {
                        if (!el.classList.contains('close-modal-btn')) {
                            el.setAttribute('readonly', 'true');
                            el.setAttribute('disabled', 'true');
                            el.classList.add('opacity-50', 'cursor-not-allowed');
                        }
                    });
                }, 100);
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // ====================
        // BASIC SYSTEM FUNCTIONS
        // ====================
        function loadData() {
            // पहले पासवर्ड लोड करें
            loadPasswords();
            
            const saved = localStorage.getItem(DATA_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    employees = data.employees || DEFAULT_EMPLOYEES;
                    payments = data.payments || [];
                    withdrawals = data.withdrawals || [];
                    activities = data.activities || [];
                    receiptCounter = data.receiptCounter || 1000;
                    withdrawalReceiptCounter = data.withdrawalReceiptCounter || 2000;
                } catch (e) {
                    console.error('Error loading data:', e);
                    initializeDefaultData();
                }
            } else {
                initializeDefaultData();
            }
            
            updateDashboard();
        }

        function initializeDefaultData() {
            employees = DEFAULT_EMPLOYEES.map(emp => ({
                ...emp,
                monthlyReceivable: CONFIG.MONTHLY_CONTRIBUTION,
                currentMonthReceivable: CONFIG.MONTHLY_CONTRIBUTION,
                lastUpdatedMonth: getCurrentMonthYear(),
                deleted: emp.deleted || false,
                parked: emp.parked || false,
                totalReceived: 0,
                status: emp.status || 'active'
            }));
            
            payments = [];
            withdrawals = [];
            activities = [{
                id: Date.now(),
                user: 'System',
                action: `System initialized with ${DEFAULT_EMPLOYEES.length} members - Fresh Start`,
                timestamp: new Date().toISOString()
            }];
            
            saveData();
        }

        function saveData() {
            const data = {
                employees,
                payments,
                withdrawals,
                activities,
                receiptCounter,
                withdrawalReceiptCounter,
                version: CONFIG.VERSION,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem(DATA_KEY, JSON.stringify(data));
            updateLastUpdated();
        }

        function addActivity(user, action) {
            activities.unshift({
                id: Date.now(),
                user,
                action,
                timestamp: new Date().toISOString()
            });
            
            saveData();
        }

        function updateLastUpdated() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-IN', { hour12: true, hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdated').textContent = `Today at ${timeStr}`;
        }

        // ====================
        // DASHBOARD FUNCTIONS
        // ====================
        function calculateCurrentMonthWithdrawn() {
            const currentMonthYear = getCurrentMonthYear();
            return withdrawals
                .filter(w => w.monthYear === currentMonthYear)
                .reduce((sum, w) => sum + w.amount, 0);
        }

        function calculateCurrentBalance() {
            const totalReceived = payments.reduce((sum, p) => sum + p.amount, 0);
            const totalWithdrawn = withdrawals.reduce((sum, w) => sum + w.amount, 0);
            return totalReceived - totalWithdrawn;
        }

        function updateDashboard() {
            const currentMonthYear = getCurrentMonthYear();
            
            document.getElementById('currentMonthYear').textContent = currentMonthYear;
            document.getElementById('currentMonthYearFooter').textContent = currentMonthYear;
            
            const activeEmployees = employees.filter(emp => !emp.deleted && !emp.parked);
            
            // Calculate totals
            const totalMembers = employees.filter(emp => !emp.deleted).length;
            const currentMonthReceivable = activeEmployees.length * CONFIG.MONTHLY_CONTRIBUTION;
            const currentMonthReceived = payments
                .filter(p => p.monthYear === currentMonthYear)
                .reduce((sum, p) => sum + p.amount, 0);
            const currentMonthWithdrawn = calculateCurrentMonthWithdrawn();
            const currentBalance = calculateCurrentBalance();
            
            // Update main stats
            document.getElementById('totalMembers').textContent = totalMembers;
            document.getElementById('totalMembersCount').textContent = totalMembers;
            document.getElementById('totalReceivable').textContent = formatCurrency(currentMonthReceivable);
            document.getElementById('currentMonthReceivable').textContent = formatCurrency(currentMonthReceivable);
            document.getElementById('currentMonthReceived').textContent = formatCurrency(currentMonthReceived);
            document.getElementById('currentMonthWithdrawn').textContent = formatCurrency(currentMonthWithdrawn);
            document.getElementById('currentBalance').textContent = formatCurrency(currentBalance);
            
            const pendingCount = activeEmployees.filter(emp => {
                const employeePayments = payments.filter(p => p.employeeId === emp.id && p.monthYear === currentMonthYear);
                return employeePayments.length === 0;
            }).length;
            
            document.getElementById('pendingMembers').textContent = pendingCount;
            document.getElementById('totalReceived').textContent = formatCurrency(currentMonthReceived);
            
            const collectionPercentage = currentMonthReceivable > 0 ? (currentMonthReceived / currentMonthReceivable * 100) : 0;
            document.getElementById('collectionProgress').style.width = `${collectionPercentage}%`;
            
            updateRecentPayments();
            updateRecentWithdrawals();
            updateRetirementStatus();
            updateDesignationCounts();
            
            const withPhoneCount = employees.filter(emp => !emp.deleted && emp.phone && emp.phone.length >= 10).length;
            document.getElementById('withPhoneCount').textContent = withPhoneCount;
            
            document.getElementById('monthlyPotential').textContent = formatCurrency(currentMonthReceivable);
            const monthlyPercentage = currentMonthReceivable > 0 ? (currentMonthReceived / currentMonthReceivable * 100) : 0;
            document.getElementById('monthlyProgress').style.width = `${monthlyPercentage}%`;
        }

        function updateDesignationCounts() {
            const activeEmployees = employees.filter(emp => !emp.deleted && !emp.parked);
            
            const assistantCount = activeEmployees.filter(emp => 
                emp.designation.toLowerCase().includes('assistant') || 
                emp.designation.toLowerCase().includes('pa') ||
                emp.designation.toLowerCase().includes('superintendent')
            ).length;
            
            const accountantCount = activeEmployees.filter(emp => 
                emp.designation.toLowerCase().includes('accountant') || 
                emp.designation.toLowerCase().includes('auditor') ||
                emp.designation.toLowerCase().includes('a/c')
            ).length;
            
            const clerkCount = activeEmployees.filter(emp => 
                emp.designation.toLowerCase().includes('clerk') || 
                emp.designation.toLowerCase().includes('steno') ||
                emp.designation.toLowerCase().includes('deo') ||
                emp.designation.toLowerCase().includes('deco') ||
                emp.designation.toLowerCase().includes('typist')
            ).length;
            
            const peonCount = activeEmployees.filter(emp => 
                emp.designation.toLowerCase().includes('peon') || 
                emp.designation.toLowerCase().includes('driver') ||
                emp.designation.toLowerCase().includes('helper')
            ).length;
            
            document.getElementById('assistantCount').textContent = assistantCount;
            document.getElementById('accountantCount').textContent = accountantCount;
            document.getElementById('clerkCount').textContent = clerkCount;
            document.getElementById('peonCount').textContent = peonCount;
        }

        function updateRecentPayments() {
            const recentPaymentsContainer = document.getElementById('recentPayments');
            const recentPayments = payments.slice(0, 10);
            
            if (recentPayments.length === 0) {
                recentPaymentsContainer.innerHTML = `
                    <div class="text-center py-4 text-gray-400">
                        <i class="fas fa-inbox text-2xl"></i>
                        <p class="mt-2">No recent payments</p>
                        <p class="text-xs mt-1">System started fresh - No payment history</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            recentPayments.forEach(payment => {
                const member = employees.find(emp => emp.id === payment.employeeId);
                html += `
                    <div class="border border-green-200 rounded-lg p-4 hover:bg-green-50">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-semibold text-gray-800">${member ? member.name : payment.employeeName}</p>
                                <p class="text-sm text-gray-600">${member ? member.designation : '-'}</p>
                                <p class="text-xs text-gray-500 mt-1">Receipt: ${payment.receiptNo}</p>
                            </div>
                            <div class="text-right">
                                <span class="font-bold text-green-700">${formatCurrency(payment.amount)}</span>
                                <p class="text-xs text-gray-600 mt-1">${formatDate(payment.date)}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            recentPaymentsContainer.innerHTML = html;
        }

        function updateRecentWithdrawals() {
            const recentWithdrawalsContainer = document.getElementById('recentWithdrawals');
            const recentWithdrawals = withdrawals.slice(0, 5);
            
            if (recentWithdrawals.length === 0) {
                recentWithdrawalsContainer.innerHTML = `
                    <div class="text-center py-4 text-gray-400">
                        <i class="fas fa-inbox text-2xl"></i>
                        <p class="mt-2">No recent withdrawals</p>
                        <p class="text-xs mt-1">System started fresh - No withdrawal history</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            recentWithdrawals.forEach(withdrawal => {
                html += `
                    <div class="border border-red-200 rounded-lg p-4 hover:bg-red-50">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-semibold text-gray-800">${withdrawal.purpose}</p>
                                <p class="text-sm text-gray-600">${withdrawal.category}</p>
                                <p class="text-xs text-gray-500 mt-1">Receipt: ${withdrawal.receiptNo}</p>
                            </div>
                            <div class="text-right">
                                <span class="font-bold text-red-700">${formatCurrency(withdrawal.amount)}</span>
                                <p class="text-xs text-gray-600 mt-1">${formatDate(withdrawal.date)}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            recentWithdrawalsContainer.innerHTML = html;
        }

        function updateRetirementStatus() {
            const now = new Date();
            const retiredEmployees = employees.filter(emp => {
                if (!emp.retirementDate || emp.deleted || emp.parked) return false;
                const retirementDate = new Date(emp.retirementDate);
                return retirementDate < now;
            });
            
            const retiringSoonEmployees = employees.filter(emp => {
                if (!emp.retirementDate || emp.deleted || emp.parked) return false;
                const retirementDate = new Date(emp.retirementDate);
                const sixMonthsFromNow = new Date();
                sixMonthsFromNow.setMonth(sixMonthsFromNow.getMonth() + 6);
                return retirementDate <= sixMonthsFromNow && retirementDate > now;
            });
            
            const activeCount = employees.filter(emp => !emp.deleted && !emp.parked).length - retiredEmployees.length - retiringSoonEmployees.length;
            
            document.getElementById('activeCount').textContent = activeCount;
            document.getElementById('retiredCount').textContent = retiredEmployees.length;
            document.getElementById('retiringSoonCount').textContent = retiringSoonEmployees.length;
            document.getElementById('retirementStatus').textContent = `${retiringSoonEmployees.length} Retiring Soon`;
        }

        // ====================
        // PAYMENT FUNCTIONS (ADMIN ONLY)
        // ====================
        function showQuickPaymentModal() {
            if (!checkAdminPermission()) return;
            
            const currentMonthYear = getCurrentMonthYear();
            const unpaidMembers = employees.filter(emp => {
                if (emp.deleted || emp.parked) return false;
                const memberPayments = payments.filter(p => p.employeeId === emp.id && p.monthYear === currentMonthYear);
                return memberPayments.length === 0;
            });

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-money-bill-wave text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Quick Payment</h3>
                                <p class="opacity-90">Record payment for current month (${currentMonthYear})</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-gray-800 mb-4">Add Payment</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Select Member</label>
                                    <select id="quickPaymentMember" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                        <option value="">-- Select Member --</option>
            `;

            unpaidMembers.forEach(member => {
                html += `<option value="${member.id}">${member.name} (${member.designation})</option>`;
            });

            html += `
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Amount (₹)</label>
                                    <input type="number" id="quickPaymentAmount" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="100" min="0">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                                    <input type="date" id="quickPaymentDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <button onclick="saveQuickPayment()" class="w-full bg-gradient-to-r from-green-600 to-emerald-700 text-white py-3 rounded-xl font-semibold hover:from-green-700 hover:to-emerald-800">
                                    <i class="fas fa-save mr-2"></i>Save Payment
                                </button>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-bold text-gray-800 mb-4">Unpaid Members (${unpaidMembers.length})</h4>
                            <div class="space-y-3 max-h-80 overflow-y-auto">
            `;

            if (unpaidMembers.length === 0) {
                html += `<p class="text-gray-500 text-center py-4">All members have paid for this month.</p>`;
            } else {
                unpaidMembers.forEach(member => {
                    html += `
                        <div class="border border-gray-200 rounded-lg p-3 hover:bg-gray-50">
                            <p class="font-semibold text-gray-800">${member.name}</p>
                            <p class="text-sm text-gray-600">${member.designation}</p>
                            <p class="text-xs text-gray-500">${member.phone || 'No phone'}</p>
                        </div>
                    `;
                });
            }

            html += `
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('Quick Payment', html, true);
        }

        function saveQuickPayment() {
            if (!checkAdminPermission()) return;
            
            const memberId = parseInt(document.getElementById('quickPaymentMember').value);
            const amount = parseInt(document.getElementById('quickPaymentAmount').value);
            const date = document.getElementById('quickPaymentDate').value;

            if (!memberId) {
                showToast('Error', 'Please select a member', 'error');
                return;
            }

            const member = employees.find(emp => emp.id === memberId);
            if (!member) {
                showToast('Error', 'Member not found', 'error');
                return;
            }

            const payment = {
                id: Date.now(),
                employeeId: member.id,
                employeeName: member.name,
                designation: member.designation,
                amount: amount,
                date: date,
                monthYear: getCurrentMonthYear(),
                receiptNo: 'R' + receiptCounter++,
                timestamp: new Date().toISOString()
            };

            payments.unshift(payment);
            member.totalReceived = (member.totalReceived || 0) + amount;

            // Update the member's currentMonthReceivable if needed
            const currentMonthYear = getCurrentMonthYear();
            if (member.lastUpdatedMonth !== currentMonthYear) {
                member.lastUpdatedMonth = currentMonthYear;
                member.currentMonthReceivable = CONFIG.MONTHLY_CONTRIBUTION - amount;
            } else {
                member.currentMonthReceivable -= amount;
            }

            saveData();
            updateDashboard();
            closeModal();
            showToast('Payment Recorded', `Payment of ₹${amount} recorded for ${member.name}`, 'success');
            addActivity(currentUser, `Recorded payment of ₹${amount} for ${member.name}`);
        }

        function recordPaymentForMember(memberId) {
            if (!checkAdminPermission()) return;
            
            const member = employees.find(emp => emp.id === memberId);
            if (!member) return;

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-money-bill-wave text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Record Payment for ${member.name}</h3>
                                <p class="opacity-90">${member.designation}</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Amount (₹)</label>
                            <input type="number" id="paymentAmount" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${CONFIG.MONTHLY_CONTRIBUTION}" min="0">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                            <input type="date" id="paymentDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Month/Year</label>
                            <select id="paymentMonthYear" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
            `;

            // Generate options for the last 12 months and current month
            const now = new Date();
            for (let i = 0; i <= 12; i++) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthYear = `${date.toLocaleString('default', { month: 'long' })} ${date.getFullYear()}`;
                const selected = i === 0 ? 'selected' : '';
                html += `<option value="${monthYear}" ${selected}>${monthYear}</option>`;
            }

            html += `
                            </select>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="savePayment(${memberId})" class="flex-1 bg-gradient-to-r from-green-600 to-emerald-700 text-white py-3 rounded-xl font-semibold hover:from-green-700 hover:to-emerald-800">
                            <i class="fas fa-save mr-2"></i>Save Payment
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </div>
            `;

            showModal(`Record Payment for ${member.name}`, html, true);
        }

        function savePayment(memberId) {
            if (!checkAdminPermission()) return;
            
            const amount = parseInt(document.getElementById('paymentAmount').value);
            const date = document.getElementById('paymentDate').value;
            const monthYear = document.getElementById('paymentMonthYear').value;

            const member = employees.find(emp => emp.id === memberId);
            if (!member) {
                showToast('Error', 'Member not found', 'error');
                return;
            }

            const payment = {
                id: Date.now(),
                employeeId: member.id,
                employeeName: member.name,
                designation: member.designation,
                amount: amount,
                date: date,
                monthYear: monthYear,
                receiptNo: 'R' + receiptCounter++,
                timestamp: new Date().toISOString()
            };

            payments.unshift(payment);
            member.totalReceived = (member.totalReceived || 0) + amount;

            // Update the member's currentMonthReceivable for the specified month
            if (member.lastUpdatedMonth !== monthYear) {
                member.lastUpdatedMonth = monthYear;
                member.currentMonthReceivable = CONFIG.MONTHLY_CONTRIBUTION - amount;
            } else {
                member.currentMonthReceivable -= amount;
            }

            saveData();
            updateDashboard();
            closeModal();
            showToast('Payment Recorded', `Payment of ₹${amount} recorded for ${member.name} for ${monthYear}`, 'success');
            addActivity(currentUser, `Recorded payment of ₹${amount} for ${member.name} for ${monthYear}`);
        }

        // ====================
        // MEMBER MANAGEMENT FUNCTIONS (ADMIN ONLY)
        // ====================
        function showAddMemberModal() {
            if (!checkAdminPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-plus text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Add New Member</h3>
                                <p class="opacity-90">Register new society member</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="newMemberName" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Enter full name">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Designation</label>
                            <select id="newMemberDesignation" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" onchange="toggleOtherDesignationInput()">
                                <option value="">-- Select Designation --</option>
            `;

            ALL_DESIGNATIONS.forEach(desg => {
                html += `<option value="${desg}">${desg}</option>`;
            });

            html += `
                            </select>
                            <div id="otherDesignationContainer" class="mt-3 hidden">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Other Designation</label>
                                <input type="text" id="otherDesignationInput" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Specify other designation">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number (10 digits)</label>
                            <input type="text" id="newMemberPhone" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="10-digit mobile number">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Joining Date</label>
                            <input type="date" id="newMemberJoinDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Retirement Date (Optional)</label>
                            <input type="date" id="newMemberRetirementDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="saveNewMember()" class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-700 text-white py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-cyan-800">
                            <i class="fas fa-save mr-2"></i>Save Member
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </div>
            `;

            showModal('Add New Member', html, true);
        }

        function toggleOtherDesignationInput() {
            const designationSelect = document.getElementById('newMemberDesignation');
            const otherContainer = document.getElementById('otherDesignationContainer');
            if (designationSelect && otherContainer) {
                if (designationSelect.value === 'Other') {
                    otherContainer.classList.remove('hidden');
                } else {
                    otherContainer.classList.add('hidden');
                }
            }
        }

        function saveNewMember() {
            if (!checkAdminPermission()) return;
            
            const name = document.getElementById('newMemberName').value.trim();
            let designation = document.getElementById('newMemberDesignation').value;
            const phone = document.getElementById('newMemberPhone').value.trim();
            const joinDate = document.getElementById('newMemberJoinDate').value;
            const retirementDate = document.getElementById('newMemberRetirementDate').value || '';

            if (designation === 'Other') {
                designation = document.getElementById('otherDesignationInput').value.trim();
            }

            if (!name || !designation) {
                showToast('Error', 'Name and designation are required', 'error');
                return;
            }

            const newId = employees.length > 0 ? Math.max(...employees.map(emp => emp.id)) + 1 : 1;

            const newMember = {
                id: newId,
                name: name,
                designation: designation,
                phone: phone,
                joinDate: joinDate,
                retirementDate: retirementDate,
                monthlyReceivable: CONFIG.MONTHLY_CONTRIBUTION,
                totalReceived: 0,
                currentMonthReceivable: CONFIG.MONTHLY_CONTRIBUTION,
                lastUpdatedMonth: getCurrentMonthYear(),
                deleted: false,
                parked: false,
                status: 'active'
            };

            employees.push(newMember);
            saveData();
            updateDashboard();
            closeModal();
            showToast('Member Added', `${name} has been added as a new member.`, 'success');
            addActivity(currentUser, `Added new member: ${name} (${designation})`);
        }

        // ====================
        // VIEW-ONLY FUNCTIONS (ALL USERS)
        // ====================
        function showAllMembersView() {
            if (!checkViewerPermission()) return;
            
            const currentMonthYear = getCurrentMonthYear();
            const activeEmployees = employees.filter(emp => !emp.deleted).sort((a, b) => a.id - b.id);
            const withPhoneCount = activeEmployees.filter(emp => emp.phone && emp.phone.length >= 10).length;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-users text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">All Members</h3>
                                <p class="opacity-90">Total: ${activeEmployees.length} active members</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode - Data cannot be modified</p>' : ''}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mt-6">
                            <div class="text-center bg-white bg-opacity-20 p-3 rounded-lg">
                                <div class="text-3xl font-bold">${activeEmployees.length}</div>
                                <div class="text-sm opacity-90">Total Members</div>
                            </div>
                            <div class="text-center bg-white bg-opacity-20 p-3 rounded-lg">
                                <div class="text-3xl font-bold">${formatCurrency(activeEmployees.length * CONFIG.MONTHLY_CONTRIBUTION)}</div>
                                <div class="text-sm opacity-90">Monthly Receivable</div>
                            </div>
                            <div class="text-center bg-white bg-opacity-20 p-3 rounded-lg">
                                <div class="text-3xl font-bold">${withPhoneCount}</div>
                                <div class="text-sm opacity-90">With Phone Number</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <div class="flex flex-col md:flex-row gap-4 mb-4">
                            <div class="flex-grow">
                                <input 
                                    type="text" 
                                    id="memberSearch" 
                                    placeholder="Search by name, designation, phone, or status..."
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition-all"
                                    ${currentUserRole === 'viewer' ? 'readonly' : ''}
                                >
                            </div>
                            <div class="flex gap-2">
                                <button onclick="filterAllMembersTable()" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-search mr-2"></i>Search
                                </button>
                                <button onclick="resetAllMemberSearch()" class="bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700">
                                    <i class="fas fa-redo mr-2"></i>Reset
                                </button>
                                <button onclick="exportMembersToExcel()" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700">
                                    <i class="fas fa-file-excel mr-2"></i>Excel
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="quickFilterMembers('pending')" class="text-xs bg-red-100 text-red-800 px-3 py-1 rounded-full hover:bg-red-200">
                                Pending Payments
                            </button>
                            <button onclick="quickFilterMembers('paid')" class="text-xs bg-green-100 text-green-800 px-3 py-1 rounded-full hover:bg-green-200">
                                Paid Members
                            </button>
                            <button onclick="quickFilterMembers('phone')" class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full hover:bg-blue-200">
                                With Phone
                            </button>
                            <button onclick="quickFilterMembers('retiring')" class="text-xs bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full hover:bg-yellow-200">
                                Retiring Soon
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Sr No</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Designation</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Phone</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Joining Date</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Retirement Date</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Current Month Status</th>
                                    ${currentUserRole === 'admin' ? '<th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Actions</th>' : ''}
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="allMembersTableBody">
            `;
            
            activeEmployees.forEach((member, index) => {
                const memberPayments = payments.filter(p => p.employeeId === member.id && p.monthYear === currentMonthYear);
                const hasPaid = memberPayments.length > 0;
                
                let statusBadge = '';
                if (hasPaid) {
                    const paidAmount = memberPayments.reduce((sum, p) => sum + p.amount, 0);
                    statusBadge = `<span class="status-badge status-paid">Paid ₹${paidAmount}</span>`;
                } else {
                    statusBadge = `<span class="status-badge status-pending">Pending ₹${CONFIG.MONTHLY_CONTRIBUTION}</span>`;
                }
                
                if (member.parked) {
                    statusBadge = `<span class="status-badge status-parked">Parked</span>`;
                }
                
                if (member.status === 'retired') {
                    statusBadge = `<span class="status-badge status-retired">Retired</span>`;
                }
                
                html += `
                    <tr class="hover:bg-gray-50 member-row" data-name="${member.name.toLowerCase()}" data-designation="${member.designation.toLowerCase()}" data-phone="${member.phone || ''}" data-status="${member.status}">
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${index + 1}</td>
                        <td class="px-4 py-3 text-sm font-semibold text-gray-900">${member.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${member.designation || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${member.phone || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${formatDate(member.joinDate)}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${member.retirementDate ? formatDate(member.retirementDate) : '-'}</td>
                        <td class="px-4 py-3">${statusBadge}</td>
                        ${currentUserRole === 'admin' ? `
                        <td class="px-4 py-3 text-sm">
                            <button onclick="editMember(${member.id})" class="text-blue-600 hover:text-blue-800 mr-3" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="recordPaymentForMember(${member.id})" class="text-green-600 hover:text-green-800" title="Add Payment">
                                <i class="fas fa-money-bill-wave"></i>
                            </button>
                        </td>
                        ` : ''}
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;
            
            showModal('All Members', html);
        }

        // ====================
        // MONTHLY REPORT FUNCTIONS (ALL USERS)
        // ====================
        function showMonthlyReport() {
            if (!checkViewerPermission()) return;
            
            // Group payments by monthYear
            const monthlyData = {};
            payments.forEach(payment => {
                if (!monthlyData[payment.monthYear]) {
                    monthlyData[payment.monthYear] = {
                        totalAmount: 0,
                        paymentCount: 0,
                        members: []
                    };
                }
                monthlyData[payment.monthYear].totalAmount += payment.amount;
                monthlyData[payment.monthYear].paymentCount++;
                if (!monthlyData[payment.monthYear].members.includes(payment.employeeId)) {
                    monthlyData[payment.monthYear].members.push(payment.employeeId);
                }
            });

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Monthly Report</h3>
                                <p class="opacity-90">Month-wise collection details</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
            `;

            // Sort months in descending order
            const sortedMonths = Object.keys(monthlyData).sort((a, b) => {
                const [monthA, yearA] = a.split(' ');
                const [monthB, yearB] = b.split(' ');
                const dateA = new Date(`${monthA} 1, ${yearA}`);
                const dateB = new Date(`${monthB} 1, ${yearB}`);
                return dateB - dateA;
            });

            if (sortedMonths.length === 0) {
                html += `<p class="text-gray-500 text-center py-4">No payment records found.</p>`;
            } else {
                sortedMonths.forEach(month => {
                    const data = monthlyData[month];
                    html += `
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="viewMonthDetails('${month}')">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-bold text-gray-800">${month}</p>
                                    <p class="text-sm text-gray-600">${data.paymentCount} payments from ${data.members.length} members</p>
                                </div>
                                <div class="text-right">
                                    <span class="font-bold text-green-700">${formatCurrency(data.totalAmount)}</span>
                                    <p class="text-xs text-gray-600">Collection</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            html += `
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('Monthly Report', html);
        }

        // ====================
        // VIEW-ONLY MODAL FUNCTIONS
        // ====================
        function viewMonthDetails(monthYear) {
            if (!checkViewerPermission()) return;
            
            const monthPayments = payments.filter(p => p.monthYear === monthYear);
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">${monthYear} Details</h3>
                                <p class="opacity-90">${monthPayments.length} payment records</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
            `;

            if (monthPayments.length === 0) {
                html += `<p class="text-gray-500 text-center py-4">No payments for this month.</p>`;
            } else {
                monthPayments.forEach(payment => {
                    const member = employees.find(emp => emp.id === payment.employeeId);
                    html += `
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-gray-800">${payment.employeeName}</p>
                                    <p class="text-sm text-gray-600">${payment.designation}</p>
                                    <p class="text-xs text-gray-500">Receipt: ${payment.receiptNo} | Date: ${formatDate(payment.date)}</p>
                                </div>
                                <span class="font-bold text-green-700">${formatCurrency(payment.amount)}</span>
                            </div>
                        </div>
                    `;
                });
            }

            html += `
                    </div>

                    <div class="flex gap-4">
                        <button onclick="showMonthlyReport()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-arrow-left mr-2"></i>Back
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal(`${monthYear} Details`, html);
        }

        // ====================
        // PAYMENT REPORTS (ALL USERS)
        // ====================
        function showPaymentReports() {
            if (!checkViewerPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-file-invoice-dollar text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Payment Reports</h3>
                                <p class="opacity-90">All payment records</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
            `;

            if (payments.length === 0) {
                html += `<p class="text-gray-500 text-center py-4">No payment records found.</p>`;
            } else {
                payments.forEach(payment => {
                    const member = employees.find(emp => emp.id === payment.employeeId);
                    html += `
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-gray-800">${payment.employeeName}</p>
                                    <p class="text-sm text-gray-600">${payment.designation}</p>
                                    <p class="text-xs text-gray-500">Receipt: ${payment.receiptNo} | Date: ${formatDate(payment.date)} | Month: ${payment.monthYear}</p>
                                </div>
                                <span class="font-bold text-green-700">${formatCurrency(payment.amount)}</span>
                            </div>
                        </div>
                    `;
                });
            }

            html += `
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('Payment Reports', html);
        }

        // ====================
        // PENDING PAYMENTS (ALL USERS)
        // ====================
        function showPendingPayments() {
            if (!checkViewerPermission()) return;
            
            const currentMonthYear = getCurrentMonthYear();
            const pendingMembers = employees.filter(emp => {
                if (emp.deleted || emp.parked) return false;
                const memberPayments = payments.filter(p => p.employeeId === emp.id && p.monthYear === currentMonthYear);
                return memberPayments.length === 0;
            });

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Pending Payments</h3>
                                <p class="opacity-90">${pendingMembers.length} members pending for ${currentMonthYear}</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
            `;

            if (pendingMembers.length === 0) {
                html += `<p class="text-green-500 text-center py-4">All members have paid for this month! 🎉</p>`;
            } else {
                pendingMembers.forEach(member => {
                    html += `
                        <div class="border border-red-200 rounded-lg p-4 hover:bg-red-50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-gray-800">${member.name}</p>
                                    <p class="text-sm text-gray-600">${member.designation}</p>
                                    <p class="text-xs text-gray-500">${member.phone || 'No phone'}</p>
                                </div>
                                <div class="text-right">
                                    <span class="font-bold text-red-700">₹${CONFIG.MONTHLY_CONTRIBUTION}</span>
                                    <p class="text-xs text-gray-600 mt-1">Pending</p>
                                    ${currentUserRole === 'admin' ? `
                                    <button onclick="recordPaymentForMember(${member.id})" class="mt-2 text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">
                                        <i class="fas fa-money-bill-wave mr-1"></i>Add Payment
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            html += `
                    </div>

                    <div class="flex gap-4">
                        ${currentUserRole === 'admin' ? `
                        <button onclick="showQuickPaymentModal()" class="flex-1 bg-gradient-to-r from-green-600 to-emerald-700 text-white py-3 rounded-xl font-semibold hover:from-green-700 hover:to-emerald-800">
                            <i class="fas fa-money-bill-wave mr-2"></i>Quick Add Payments
                        </button>
                        ` : ''}
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('Pending Payments', html);
        }

        // ====================
        // ADMIN-ONLY FUNCTIONS
        // ====================
        function showAllMembersEdit() {
            if (!checkAdminPermission()) return;
            
            const currentMonthYear = getCurrentMonthYear();
            const activeEmployees = employees.filter(emp => !emp.deleted).sort((a, b) => a.id - b.id);
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-edit text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Edit Members</h3>
                                <p class="opacity-90">Edit member details and status</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Sr No</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Designation</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Phone</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
            `;
            
            activeEmployees.forEach((member, index) => {
                let statusBadge = '';
                if (member.parked) {
                    statusBadge = `<span class="status-badge status-parked">Parked</span>`;
                } else if (member.status === 'retired' || member.deleted) {
                    statusBadge = `<span class="status-badge status-retired">Retired</span>`;
                } else {
                    const memberPayments = payments.filter(p => p.employeeId === member.id && p.monthYear === currentMonthYear);
                    const hasPaid = memberPayments.length > 0;
                    statusBadge = hasPaid ? 
                        `<span class="status-badge status-paid">Paid</span>` : 
                        `<span class="status-badge status-pending">Pending</span>`;
                }
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${index + 1}</td>
                        <td class="px-4 py-3 text-sm font-semibold text-gray-900">${member.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${member.designation || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${member.phone || '-'}</td>
                        <td class="px-4 py-3">${statusBadge}</td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="editMember(${member.id})" class="text-blue-600 hover:text-blue-800 mr-3" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="toggleParkMember(${member.id})" class="text-gray-600 hover:text-gray-800 mr-3" title="${member.parked ? 'Unpark' : 'Park'}">
                                <i class="fas ${member.parked ? 'fa-play' : 'fa-pause'}"></i>
                            </button>
                            <button onclick="markAsRetired(${member.id})" class="text-orange-600 hover:text-orange-800 mr-3" title="Mark as Retired">
                                <i class="fas fa-user-clock"></i>
                            </button>
                            <button onclick="deleteMember(${member.id})" class="text-red-600 hover:text-red-800" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;
            
            showModal('Edit Members', html, true);
        }

        // ====================
        // EDIT MEMBER FUNCTIONS (ADMIN ONLY)
        // ====================
        function editMember(id) {
            if (!checkAdminPermission()) return;
            
            const member = employees.find(emp => emp.id === id);
            if (!member) return;

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-edit text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Edit ${member.name}</h3>
                                <p class="opacity-90">Update member details</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="editMemberName" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${member.name}">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Designation</label>
                            <select id="editMemberDesignation" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" onchange="toggleEditOtherDesignationInput()">
                                <option value="">-- Select Designation --</option>
            `;

            ALL_DESIGNATIONS.forEach(desg => {
                const selected = desg === member.designation ? 'selected' : '';
                html += `<option value="${desg}" ${selected}>${desg}</option>`;
            });

            html += `
                            </select>
                            <div id="editOtherDesignationContainer" class="mt-3 ${member.designation && !ALL_DESIGNATIONS.includes(member.designation) ? '' : 'hidden'}">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Other Designation</label>
                                <input type="text" id="editOtherDesignationInput" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${member.designation && !ALL_DESIGNATIONS.includes(member.designation) ? member.designation : ''}">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number (10 digits)</label>
                            <input type="text" id="editMemberPhone" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${member.phone || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Joining Date</label>
                            <input type="date" id="editMemberJoinDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${member.joinDate || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Retirement Date (Optional)</label>
                            <input type="date" id="editMemberRetirementDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${member.retirementDate || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                            <select id="editMemberStatus" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="active" ${member.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="retired" ${member.status === 'retired' ? 'selected' : ''}>Retired</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="saveMemberEdit(${member.id})" class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-700 text-white py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-cyan-800">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </div>
            `;

            showModal(`Edit ${member.name}`, html, true);
        }

        function toggleEditOtherDesignationInput() {
            const designationSelect = document.getElementById('editMemberDesignation');
            const otherContainer = document.getElementById('editOtherDesignationContainer');
            if (designationSelect && otherContainer) {
                if (designationSelect.value === 'Other') {
                    otherContainer.classList.remove('hidden');
                } else {
                    otherContainer.classList.add('hidden');
                }
            }
        }

        function saveMemberEdit(id) {
            if (!checkAdminPermission()) return;
            
            const member = employees.find(emp => emp.id === id);
            if (!member) return;

            const name = document.getElementById('editMemberName').value.trim();
            let designation = document.getElementById('editMemberDesignation').value;
            const phone = document.getElementById('editMemberPhone').value.trim();
            const joinDate = document.getElementById('editMemberJoinDate').value;
            const retirementDate = document.getElementById('editMemberRetirementDate').value || '';
            const status = document.getElementById('editMemberStatus').value;

            if (designation === 'Other') {
                designation = document.getElementById('editOtherDesignationInput').value.trim();
            }

            if (!name || !designation) {
                showToast('Error', 'Name and designation are required', 'error');
                return;
            }

            member.name = name;
            member.designation = designation;
            member.phone = phone;
            member.joinDate = joinDate;
            member.retirementDate = retirementDate;
            member.status = status;

            saveData();
            updateDashboard();
            closeModal();
            showToast('Member Updated', `${name} details updated successfully.`, 'success');
            addActivity(currentUser, `Updated member: ${name}`);
        }

        function toggleParkMember(id) {
            if (!checkAdminPermission()) return;
            
            const member = employees.find(emp => emp.id === id);
            if (!member) return;

            member.parked = !member.parked;
            member.status = member.parked ? 'parked' : 'active';
            
            saveData();
            updateDashboard();
            showToast('Member Status Changed', `${member.name} has been ${member.parked ? 'parked' : 'unparked'}`, 'success');
            addActivity(currentUser, `${member.parked ? 'Parked' : 'Unparked'} member: ${member.name}`);
            
            // Refresh the edit members view
            showAllMembersEdit();
        }

        function markAsRetired(id) {
            if (!checkAdminPermission()) return;
            
            const member = employees.find(emp => emp.id === id);
            if (!member) return;

            if (confirm(`Are you sure you want to mark ${member.name} as retired? This action cannot be undone.`)) {
                member.status = 'retired';
                member.deleted = true;
                member.retirementDate = member.retirementDate || new Date().toISOString().split('T')[0];
                
                saveData();
                updateDashboard();
                showToast('Member Retired', `${member.name} has been marked as retired.`, 'success');
                addActivity(currentUser, `Marked member as retired: ${member.name}`);
                
                // Refresh the edit members view
                showAllMembersEdit();
            }
        }

        function deleteMember(id) {
            if (!checkAdminPermission()) return;
            
            const member = employees.find(emp => emp.id === id);
            if (!member) return;

            if (confirm(`Are you sure you want to delete ${member.name}? This action cannot be undone.`)) {
                member.deleted = true;
                member.status = 'deleted';
                
                saveData();
                updateDashboard();
                showToast('Member Deleted', `${member.name} has been deleted.`, 'success');
                addActivity(currentUser, `Deleted member: ${member.name}`);
                
                // Refresh the edit members view
                showAllMembersEdit();
            }
        }

        // ====================
        // SEARCH FUNCTIONS (ALL USERS)
        // ====================
        function filterAllMembersTable() {
            const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#allMembersTableBody .member-row');
            
            rows.forEach(row => {
                const name = row.getAttribute('data-name');
                const designation = row.getAttribute('data-designation');
                const phone = row.getAttribute('data-phone');
                const status = row.getAttribute('data-status');
                
                if (name.includes(searchTerm) || 
                    designation.includes(searchTerm) || 
                    phone.includes(searchTerm) ||
                    status.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function resetAllMemberSearch() {
            document.getElementById('memberSearch').value = '';
            const rows = document.querySelectorAll('#allMembersTableBody .member-row');
            rows.forEach(row => {
                row.style.display = '';
            });
        }

        function quickFilterMembers(type) {
            let searchTerm = '';
            switch(type) {
                case 'pending':
                    searchTerm = 'pending';
                    break;
                case 'paid':
                    searchTerm = 'paid';
                    break;
                case 'phone':
                    // Show members with phone numbers
                    const rows = document.querySelectorAll('#allMembersTableBody .member-row');
                    rows.forEach(row => {
                        const phone = row.getAttribute('data-phone');
                        if (phone && phone.length > 5) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                    return;
                case 'retiring':
                    searchTerm = 'retiring';
                    break;
            }
            document.getElementById('memberSearch').value = searchTerm;
            filterAllMembersTable();
        }

        // ====================
        // WHATSAPP MESSAGING (ADMIN ONLY)
        // ====================
        function showMessagingPanel() {
            if (!checkAdminPermission()) return;
            
            const activeMembers = employees.filter(emp => !emp.deleted && !emp.parked && emp.phone && emp.phone.length >= 10);

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fab fa-whatsapp text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">WhatsApp Messaging</h3>
                                <p class="opacity-90">Send reminders or messages to members</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <h4 class="font-bold text-gray-800 mb-4">Message Template</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Select Template</label>
                                    <select id="messageTemplate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" onchange="loadMessageTemplate()">
                                        <option value="">-- Select Template --</option>
                                        <option value="payment_reminder">Payment Reminder</option>
                                        <option value="meeting_notice">Meeting Notice</option>
                                        <option value="festival_greeting">Festival Greeting</option>
                                        <option value="custom">Custom Message</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Message</label>
                                    <textarea id="whatsappMessage" rows="10" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Type your message here..."></textarea>
                                </div>
                                <div class="text-sm text-gray-600">
                                    <p><i class="fas fa-info-circle mr-2"></i>You can use variables: {name}, {designation}, {phone}, {dues}</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-bold text-gray-800 mb-4">Select Members (${activeMembers.length} with phone)</h4>
                            <div class="bg-gray-100 p-4 rounded-lg max-h-96 overflow-y-auto">
                                <div class="flex justify-between mb-3">
                                    <button onclick="selectAllWhatsAppMembers()" class="text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Select All</button>
                                    <button onclick="deselectAllWhatsAppMembers()" class="text-sm bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700">Deselect All</button>
                                </div>
                                <div class="space-y-2" id="whatsappMemberList">
            `;

            activeMembers.forEach(member => {
                const memberPayments = payments.filter(p => p.employeeId === member.id && p.monthYear === getCurrentMonthYear());
                const hasPaid = memberPayments.length > 0;
                const dues = hasPaid ? 0 : CONFIG.MONTHLY_CONTRIBUTION;

                html += `
                    <div class="flex items-center border border-gray-200 rounded p-2 hover:bg-white">
                        <input type="checkbox" id="member_${member.id}" value="${member.id}" class="whatsapp-member-checkbox mr-2" data-name="${member.name}" data-phone="${member.phone}" data-dues="${dues}">
                        <label for="member_${member.id}" class="flex-grow">
                            <p class="font-semibold text-gray-800">${member.name}</p>
                            <p class="text-xs text-gray-600">${member.phone} | ${member.designation}</p>
                            <p class="text-xs ${hasPaid ? 'text-green-600' : 'text-red-600'}">${hasPaid ? 'Paid' : `Due: ₹${dues}`}</p>
                        </label>
                    </div>
                `;
            });

            html += `
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-bold text-blue-800 mb-2">Generated WhatsApp Links</h4>
                        <div class="space-y-2" id="whatsappLinks">
                            <p class="text-sm text-blue-600">Select members and click "Generate WhatsApp Links"</p>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="generateWhatsAppLinksFixed()" class="flex-1 bg-gradient-to-r from-green-600 to-teal-700 text-white py-3 rounded-xl font-semibold hover:from-green-700 hover:to-teal-800">
                            <i class="fab fa-whatsapp mr-2"></i>Generate WhatsApp Links
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('WhatsApp Messaging', html, true);
        }

        function selectAllWhatsAppMembers() {
            document.querySelectorAll('.whatsapp-member-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        function deselectAllWhatsAppMembers() {
            document.querySelectorAll('.whatsapp-member-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function loadMessageTemplate() {
            const template = document.getElementById('messageTemplate').value;
            let message = '';

            switch(template) {
                case 'payment_reminder':
                    message = `Dear {name},\n\nThis is a reminder to pay your monthly contribution of ₹${CONFIG.MONTHLY_CONTRIBUTION} for the month of ${getCurrentMonthYear()}.\n\nThank you.\nDGST Welfare Society`;
                    break;
                case 'meeting_notice':
                    message = `Dear {name},\n\nThere will be a society meeting on [Date] at [Time] in [Venue]. Please attend.\n\nThank you.\nDGST Welfare Society`;
                    break;
                case 'festival_greeting':
                    message = `Dear {name},\n\nWishing you and your family a very happy festival. May this occasion bring joy and prosperity.\n\nBest regards,\nDGST Welfare Society`;
                    break;
                case 'custom':
                    message = '';
                    break;
            }

            document.getElementById('whatsappMessage').value = message;
        }

        function generateWhatsAppLinksFixed() {
            if (!checkAdminPermission()) return;
            
            const message = document.getElementById('whatsappMessage').value;
            if (!message) {
                showToast('Error', 'Please enter a message', 'error');
                return;
            }

            const selectedCheckboxes = document.querySelectorAll('.whatsapp-member-checkbox:checked');
            if (selectedCheckboxes.length === 0) {
                showToast('Error', 'Please select at least one member', 'error');
                return;
            }

            let linksHtml = '';
            selectedCheckboxes.forEach(checkbox => {
                const memberId = checkbox.value;
                const member = employees.find(emp => emp.id === parseInt(memberId));
                if (member) {
                    let personalizedMessage = message
                        .replace(/{name}/g, member.name)
                        .replace(/{designation}/g, member.designation)
                        .replace(/{phone}/g, member.phone)
                        .replace(/{dues}/g, CONFIG.MONTHLY_CONTRIBUTION);

                    const encodedMessage = encodeURIComponent(personalizedMessage);
                    const whatsappLink = `https://wa.me/91${member.phone}?text=${encodedMessage}`;
                    linksHtml += `
                        <div class="border border-green-200 rounded p-3 mb-2">
                            <p class="font-semibold text-gray-800">${member.name} (${member.phone})</p>
                            <p class="text-sm text-gray-600 truncate">${personalizedMessage.substring(0, 50)}...</p>
                            <a href="${whatsappLink}" target="_blank" class="text-green-600 hover:text-green-800 text-sm">
                                <i class="fab fa-whatsapp mr-1"></i>Open in WhatsApp
                            </a>
                        </div>
                    `;
                }
            });

            document.getElementById('whatsappLinks').innerHTML = linksHtml;
            showToast('Links Generated', `${selectedCheckboxes.length} WhatsApp links generated`, 'success');
        }

        // ====================
        // WITHDRAWAL FUNCTIONS (ADMIN ONLY)
        // ====================
        function showMainAccountWithdrawalModal() {
            if (!checkAdminPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-university text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Main Account Withdrawal</h3>
                                <p class="opacity-90">Withdraw from society account</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Withdrawal Purpose</label>
                            <input type="text" id="withdrawalPurpose" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="e.g., Festival advance, Office party">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Amount (₹)</label>
                            <input type="number" id="withdrawalAmount" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" min="0">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                            <input type="date" id="withdrawalDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
                            <select id="withdrawalCategory" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">-- Select Category --</option>
            `;

            EXPENSE_CATEGORIES.forEach(cat => {
                html += `<option value="${cat}">${cat}</option>`;
            });

            html += `
                            </select>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="processWithdrawal()" class="flex-1 bg-gradient-to-r from-amber-600 to-orange-700 text-white py-3 rounded-xl font-semibold hover:from-amber-700 hover:to-orange-800">
                            <i class="fas fa-save mr-2"></i>Record Withdrawal
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </div>
            `;

            showModal('Main Account Withdrawal', html, true);
        }

        function processWithdrawal() {
            if (!checkAdminPermission()) return;
            
            const purpose = document.getElementById('withdrawalPurpose').value.trim();
            const amount = parseInt(document.getElementById('withdrawalAmount').value);
            const date = document.getElementById('withdrawalDate').value;
            const category = document.getElementById('withdrawalCategory').value;

            if (!purpose || !amount || !category) {
                showToast('Error', 'Please fill all fields', 'error');
                return;
            }

            const withdrawal = {
                id: Date.now(),
                purpose: purpose,
                amount: amount,
                date: date,
                category: category,
                receiptNo: 'W' + withdrawalReceiptCounter++,
                monthYear: getCurrentMonthYear(),
                timestamp: new Date().toISOString()
            };

            withdrawals.unshift(withdrawal);
            saveData();
            updateDashboard();
            closeModal();
            showToast('Withdrawal Recorded', `Withdrawal of ₹${amount} for ${purpose} recorded`, 'success');
            addActivity(currentUser, `Recorded withdrawal of ₹${amount} for ${purpose}`);
        }

        // ====================
        // WITHDRAWAL REPORTS (ALL USERS)
        // ====================
        function showWithdrawalReports() {
            if (!checkViewerPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-pink-500 to-rose-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-file-invoice text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Withdrawal Reports</h3>
                                <p class="opacity-90">All withdrawal records</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
            `;

            if (withdrawals.length === 0) {
                html += `<p class="text-gray-500 text-center py-4">No withdrawal records found.</p>`;
            } else {
                withdrawals.forEach(withdrawal => {
                    html += `
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-gray-800">${withdrawal.purpose}</p>
                                    <p class="text-sm text-gray-600">${withdrawal.category}</p>
                                    <p class="text-xs text-gray-500">Receipt: ${withdrawal.receiptNo} | Date: ${formatDate(withdrawal.date)}</p>
                                </div>
                                <span class="font-bold text-red-700">${formatCurrency(withdrawal.amount)}</span>
                            </div>
                        </div>
                    `;
                });
            }

            html += `
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('Withdrawal Reports', html);
        }

        // ====================
        // PARKED MEMBERS VIEW (ALL USERS)
        // ====================
        function showParkedMembers() {
            if (!checkViewerPermission()) return;
            
            const parkedMembers = employees.filter(emp => emp.parked);
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-gray-500 to-gray-700 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-parking text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Parked Members</h3>
                                <p class="opacity-90">Non-contributing members (${parkedMembers.length})</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
            `;
            
            if (parkedMembers.length === 0) {
                html += `
                    <div class="text-center py-12 text-gray-400">
                        <i class="fas fa-car text-4xl mb-4"></i>
                        <p class="text-xl">No Parked Members</p>
                        <p class="text-sm mt-2">All members are currently active</p>
                    </div>
                `;
            } else {
                parkedMembers.forEach(member => {
                    html += `
                        <div class="border border-gray-300 rounded-lg p-4 hover:bg-gray-50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-gray-800">${member.name}</p>
                                    <p class="text-sm text-gray-600">${member.designation || 'No designation'}</p>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <i class="fas fa-calendar mr-1"></i>Joined: ${formatDate(member.joinDate)}
                                    </p>
                                    ${member.phone ? `<p class="text-xs text-blue-600 mt-1"><i class="fas fa-phone mr-1"></i>${member.phone}</p>` : ''}
                                </div>
                                <div class="text-right">
                                    <span class="text-sm text-gray-500 font-semibold">Parked</span>
                                    ${currentUserRole === 'admin' ? `
                                    <button onclick="toggleParkMember(${member.id})" class="mt-2 text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
                                        <i class="fas fa-play mr-1"></i>Unpark
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;
            
            showModal('Parked Members', html);
        }

        // ====================
        // RETIRED MEMBERS VIEW (ALL USERS)
        // ====================
        function showRetiredMembersDetails() {
            if (!checkViewerPermission()) return;
            
            const retiredEmployees = employees.filter(emp => emp.status === 'retired' || emp.deleted);
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-orange-500 to-amber-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-clock text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Retired/Exit Members</h3>
                                <p class="opacity-90">Complete retirement/exit details</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>
                    
                    <!-- SEARCH SECTION FOR RETIRED MEMBERS -->
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-grow">
                                <input 
                                    type="text" 
                                    id="retiredSearch" 
                                    placeholder="Search retired members by name, designation, or phone..."
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition-all"
                                    ${currentUserRole === 'viewer' ? 'readonly' : ''}
                                >
                            </div>
                            <button onclick="filterRetiredMembers()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-3" id="retiredMembersList">
            `;
            
            if (retiredEmployees.length === 0) {
                html += `
                    <div class="text-center py-12 text-gray-400">
                        <i class="fas fa-user-check text-4xl mb-4"></i>
                        <p class="text-xl">No Retired/Exit Members</p>
                        <p class="text-sm mt-2">No members have retired or exited yet</p>
                    </div>
                `;
            } else {
                retiredEmployees.forEach(member => {
                    html += `
                        <div class="border border-orange-200 rounded-lg p-4 hover:bg-orange-50 retired-member-item" 
                             data-name="${member.name.toLowerCase()}" 
                             data-designation="${member.designation.toLowerCase()}" 
                             data-phone="${member.phone || ''}">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-gray-800">${member.name}</p>
                                    <p class="text-sm text-gray-600">${member.designation || 'No designation'}</p>
                                    <p class="text-xs text-orange-600 mt-1">
                                        <i class="fas fa-calendar-minus mr-1"></i>${member.retirementDate ? `Retired: ${formatDate(member.retirementDate)}` : 'Exited'}
                                    </p>
                                    ${member.phone ? `<p class="text-xs text-blue-600 mt-1"><i class="fas fa-phone mr-1"></i>${member.phone}</p>` : ''}
                                </div>
                                <span class="text-sm text-orange-500 font-semibold">${member.status === 'retired' ? 'Retired' : 'Exited'}</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;
            
            showModal('Retired/Exit Members', html);
        }

        function filterRetiredMembers() {
            const searchTerm = document.getElementById('retiredSearch').value.toLowerCase();
            const items = document.querySelectorAll('.retired-member-item');
            
            items.forEach(item => {
                const name = item.getAttribute('data-name');
                const designation = item.getAttribute('data-designation');
                const phone = item.getAttribute('data-phone');
                
                if (name.includes(searchTerm) || designation.includes(searchTerm) || phone.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ====================
        // RETIREMENT DETAILS VIEW (ALL USERS)
        // ====================
        function showRetirementDetails(type) {
            if (!checkViewerPermission()) return;
            
            let filteredEmployees = [];
            let title = '';
            let color = '';

            switch(type) {
                case 'active':
                    filteredEmployees = employees.filter(emp => !emp.deleted && !emp.parked && emp.status === 'active');
                    title = 'Active Members';
                    color = 'green';
                    break;
                case 'retiring-soon':
                    const now = new Date();
                    const sixMonthsFromNow = new Date();
                    sixMonthsFromNow.setMonth(sixMonthsFromNow.getMonth() + 6);
                    filteredEmployees = employees.filter(emp => {
                        if (!emp.retirementDate || emp.deleted || emp.parked) return false;
                        const retirementDate = new Date(emp.retirementDate);
                        return retirementDate <= sixMonthsFromNow && retirementDate > now;
                    });
                    title = 'Retiring Soon Members (within 6 months)';
                    color = 'yellow';
                    break;
                case 'retired':
                    filteredEmployees = employees.filter(emp => emp.status === 'retired' || emp.deleted);
                    title = 'Retired Members';
                    color = 'red';
                    break;
            }

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-${color}-500 to-${color}-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-users text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">${title}</h3>
                                <p class="opacity-90">${filteredEmployees.length} members</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
            `;

            if (filteredEmployees.length === 0) {
                html += `<p class="text-gray-500 text-center py-4">No members found.</p>`;
            } else {
                filteredEmployees.forEach(member => {
                    html += `
                        <div class="border border-${color}-200 rounded-lg p-4 hover:bg-${color}-50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-gray-800">${member.name}</p>
                                    <p class="text-sm text-gray-600">${member.designation}</p>
                                    <p class="text-xs text-${color}-600 mt-1">
                                        <i class="fas fa-calendar mr-1"></i>${member.retirementDate ? `Retirement: ${formatDate(member.retirementDate)}` : 'No retirement date'}
                                    </p>
                                    ${member.phone ? `<p class="text-xs text-blue-600 mt-1"><i class="fas fa-phone mr-1"></i>${member.phone}</p>` : ''}
                                </div>
                                <span class="text-sm text-${color}-500 font-semibold">${type === 'active' ? 'Active' : (type === 'retiring-soon' ? 'Soon' : 'Retired')}</span>
                            </div>
                        </div>
                    `;
                });
            }

            html += `
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal(title, html);
        }

        // ====================
        // EXCEL EXPORT FUNCTIONS (ALL USERS)
        // ====================
        function showExcelExportOptions() {
            if (!checkViewerPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-500 to-teal-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-file-excel text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Excel Data Export</h3>
                                <p class="opacity-90">Export data in Excel format</p>
                                ${currentUserRole === 'viewer' ? '<p class="text-xs opacity-75 mt-2"><i class="fas fa-eye mr-1"></i> View Only Mode</p>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 p-6 rounded-xl text-center hover:bg-blue-100 cursor-pointer" onclick="exportMembersToExcel()">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-users text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Members Data</h4>
                            <p class="text-sm text-gray-600 mt-2">Export all member details</p>
                        </div>

                        <div class="bg-green-50 p-6 rounded-xl text-center hover:bg-green-100 cursor-pointer" onclick="exportPaymentsToExcel()">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-money-bill-wave text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Payments Data</h4>
                            <p class="text-sm text-gray-600 mt-2">Export all payment records</p>
                        </div>

                        <div class="bg-purple-50 p-6 rounded-xl text-center hover:bg-purple-100 cursor-pointer" onclick="exportCompleteData()">
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-database text-purple-600 text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Complete Data</h4>
                            <p class="text-sm text-gray-600 mt-2">Export everything in one file</p>
                        </div>
                    </div>

                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h4 class="font-bold text-gray-800 mb-2">Export Instructions</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Data will be exported as CSV file</li>
                            <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Open in Microsoft Excel or Google Sheets</li>
                            <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Files are compatible with all spreadsheet software</li>
                        </ul>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('Excel Export Options', html);
        }

        function exportMembersToExcel() {
            if (!checkViewerPermission()) return;
            
            const activeEmployees = employees.filter(emp => !emp.deleted);
            
            let csvContent = "Sr No,Name,Designation,Phone,Joining Date,Retirement Date,Monthly Receivable,Total Received,Status\n";
            
            activeEmployees.forEach((member, index) => {
                csvContent += `${index + 1},"${member.name}","${member.designation || ''}","${member.phone || ''}","${formatDate(member.joinDate)}","${formatDate(member.retirementDate)}",₹${member.monthlyReceivable},₹${member.totalReceived},${member.status}\n`;
            });
            
            downloadCSV(csvContent, `DGST_Members_${new Date().toISOString().split('T')[0]}.csv`);
            showToast('Export Successful', 'Members data exported to Excel', 'success');
        }

        function exportPaymentsToExcel() {
            if (!checkViewerPermission()) return;
            
            let csvContent = "Receipt No,Name,Designation,Amount,Date,Month/Year\n";
            
            payments.forEach(payment => {
                csvContent += `${payment.receiptNo},"${payment.employeeName}","${payment.designation}",₹${payment.amount},"${formatDate(payment.date)}","${payment.monthYear}"\n`;
            });
            
            downloadCSV(csvContent, `DGST_Payments_${new Date().toISOString().split('T')[0]}.csv`);
            showToast('Export Successful', 'Payments data exported to Excel', 'success');
        }

        function exportCompleteData() {
            if (!checkViewerPermission()) return;
            
            let csvContent = "Type,ID,Name,Designation,Amount,Date,Month/Year,Receipt No,Details\n";
            
            // Add payments
            payments.forEach(payment => {
                csvContent += `Payment,${payment.employeeId},"${payment.employeeName}","${payment.designation}",₹${payment.amount},"${formatDate(payment.date)}","${payment.monthYear}",${payment.receiptNo},"Payment received"\n`;
            });
            
            // Add withdrawals
            withdrawals.forEach(withdrawal => {
                csvContent += `Withdrawal,-,"-","-",₹${withdrawal.amount},"${formatDate(withdrawal.date)}","${withdrawal.monthYear}",${withdrawal.receiptNo},"${withdrawal.purpose} (${withdrawal.category})"\n`;
            });
            
            downloadCSV(csvContent, `DGST_Complete_Data_${new Date().toISOString().split('T')[0]}.csv`);
            showToast('Export Successful', 'Complete data exported to Excel', 'success');
        }

        function downloadCSV(content, fileName) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            
            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, fileName);
            } else {
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                link.style.display = "none";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function exportDataForEmail() {
            if (!checkViewerPermission()) return;
            
            const data = {
                employees: employees.filter(emp => !emp.deleted),
                payments: payments,
                withdrawals: withdrawals,
                activities: activities,
                summary: {
                    totalMembers: employees.filter(emp => !emp.deleted).length,
                    currentBalance: calculateCurrentBalance(),
                    lastUpdated: new Date().toISOString()
                }
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `DGST_Backup_${new Date().toISOString().split('T')[0]}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Backup Created', 'JSON file downloaded successfully', 'success');
            addActivity(currentUser, 'Exported data backup as JSON');
        }

        // ====================
        // RESET DATA FUNCTIONS (ADMIN ONLY)
        // ====================
        function showResetDataModal() {
            if (!checkAdminPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-redo text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Reset Data</h3>
                                <p class="opacity-90">Secure reset with backup & restore</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                        <h4 class="font-bold text-red-800 mb-4">⚠️ Warning: This action cannot be undone!</h4>
                        <p class="text-red-700 mb-4">This will reset all data (payments, withdrawals, activities) and restore the default member list. Make sure to backup your data before proceeding.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-red-700 mb-2">Enter Security Question: ${CONFIG.SECURITY_QUESTIONS[0]}</label>
                                <input type="text" id="securityAnswer" class="w-full p-3 border-2 border-red-300 rounded-lg focus:border-red-500 focus:outline-none" placeholder="Your answer">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-red-700 mb-2">Type "RESET" to confirm</label>
                                <input type="text" id="resetConfirm" class="w-full p-3 border-2 border-red-300 rounded-lg focus:border-red-500 focus:outline-none" placeholder="Type RESET here">
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="performReset()" class="flex-1 bg-gradient-to-r from-red-600 to-pink-700 text-white py-3 rounded-xl font-semibold hover:from-red-700 hover:to-pink-800">
                            <i class="fas fa-bomb mr-2"></i>Reset All Data
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </div>
            `;

            showModal('Reset Data', html, true);
        }

        function performReset() {
            if (!checkAdminPermission()) return;
            
            const securityAnswer = document.getElementById('securityAnswer').value.trim();
            const resetConfirm = document.getElementById('resetConfirm').value.trim();

            if (securityAnswer !== CONFIG.SECURITY_ANSWERS[0]) {
                showToast('Error', 'Security answer is incorrect', 'error');
                return;
            }

            if (resetConfirm !== 'RESET') {
                showToast('Error', 'Please type "RESET" to confirm', 'error');
                return;
            }

            // डेटा रीसेट करें
            employees = DEFAULT_EMPLOYEES.map(emp => ({
                ...emp,
                monthlyReceivable: CONFIG.MONTHLY_CONTRIBUTION,
                currentMonthReceivable: CONFIG.MONTHLY_CONTRIBUTION,
                lastUpdatedMonth: getCurrentMonthYear(),
                deleted: emp.deleted || false,
                parked: emp.parked || false,
                totalReceived: 0,
                status: emp.status || 'active'
            }));
            
            payments = [];
            withdrawals = [];
            activities = [{
                id: Date.now(),
                user: 'System',
                action: `System reset with ${DEFAULT_EMPLOYEES.length} members`,
                timestamp: new Date().toISOString()
            }];
            
            saveData();
            updateDashboard();
            closeModal();
            showToast('Data Reset', 'All data has been reset to default', 'success');
            addActivity(currentUser, 'Reset all data to default');
        }

        // ====================
        // SETTINGS FUNCTIONS (ADMIN ONLY)
        // ====================
        function showSettingsModal() {
            if (!checkAdminPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-gray-500 to-gray-700 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-cog text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">System Settings</h3>
                                <p class="opacity-90">Configure system preferences</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-2">System Information</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Version:</span>
                                    <span class="font-semibold">${CONFIG.VERSION}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Members:</span>
                                    <span class="font-semibold">${employees.filter(emp => !emp.deleted).length}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Monthly Contribution:</span>
                                    <span class="font-semibold">₹${CONFIG.MONTHLY_CONTRIBUTION}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Data Last Updated:</span>
                                    <span class="font-semibold">${document.getElementById('lastUpdated').textContent}</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-green-800 mb-2">Backup & Restore</h4>
                            <p class="text-sm text-green-700 mb-3">Regularly backup your data to prevent loss</p>
                            <button onclick="exportDataForEmail()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                                <i class="fas fa-download mr-2"></i>Create Backup Now
                            </button>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="font-bold text-yellow-800 mb-2">Password Management</h4>
                            <p class="text-sm text-yellow-700 mb-3">Change system access passwords</p>
                            <button onclick="showChangePasswordModal()" class="w-full bg-yellow-600 text-white py-2 rounded-lg hover:bg-yellow-700">
                                <i class="fas fa-key mr-2"></i>Change Passwords
                            </button>
                        </div>

                        <div class="bg-red-50 p-4 rounded-lg">
                            <h4 class="font-bold text-red-800 mb-2">Danger Zone</h4>
                            <p class="text-sm text-red-700 mb-3">These actions are irreversible</p>
                            <button onclick="showResetDataModal()" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-redo mr-2"></i>Reset All Data
                            </button>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Close
                        </button>
                    </div>
                </div>
            `;

            showModal('System Settings', html, true);
        }

        // ====================
        // CHANGE PASSWORD FUNCTION (ADMIN ONLY)
        // ====================
        function showChangePasswordModal() {
            if (!checkAdminPermission()) return;
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-key text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">Change Password</h3>
                                <p class="opacity-90">Update system access passwords</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Current Admin Password</label>
                            <input type="password" id="currentAdminPass" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Enter current admin password">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">New Admin Password</label>
                            <input type="password" id="newAdminPass" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Enter new admin password">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Confirm New Admin Password</label>
                            <input type="password" id="confirmAdminPass" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Confirm new admin password">
                        </div>
                        
                        <div class="border-t pt-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">New Viewer Password</label>
                                <input type="password" id="newViewerPass" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Enter new viewer password">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Confirm Viewer Password</label>
                                <input type="password" id="confirmViewerPass" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="Confirm viewer password">
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="changePassword()" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-700 text-white py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-800">
                            <i class="fas fa-save mr-2"></i>Update Passwords
                        </button>
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-400 close-modal-btn">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </div>
            `;

            showModal('Change Password', html, true);
        }

        function changePassword() {
            if (!checkAdminPermission()) return;
            
            const currentAdminPass = document.getElementById('currentAdminPass').value;
            const newAdminPass = document.getElementById('newAdminPass').value;
            const confirmAdminPass = document.getElementById('confirmAdminPass').value;
            const newViewerPass = document.getElementById('newViewerPass').value;
            const confirmViewerPass = document.getElementById('confirmViewerPass').value;

            // वैलिडेशन
            let errors = [];

            // एडमिन पासवर्ड चेक
            if (currentAdminPass !== CONFIG.ADMIN_PASSWORD) {
                errors.push('Current admin password is incorrect');
            }

            if (newAdminPass && newAdminPass !== confirmAdminPass) {
                errors.push('New admin passwords do not match');
            }

            if (newAdminPass && newAdminPass.length < 4) {
                errors.push('New admin password must be at least 4 characters');
            }

            // व्यूअर पासवर्ड चेक
            if (newViewerPass && newViewerPass !== confirmViewerPass) {
                errors.push('Viewer passwords do not match');
            }

            if (newViewerPass && newViewerPass.length < 4) {
                errors.push('New viewer password must be at least 4 characters');
            }

            if (errors.length > 0) {
                showToast('Error', errors.join(', '), 'error');
                return;
            }

            // पासवर्ड सेव करें
            const success = savePasswords(
                newAdminPass || CONFIG.ADMIN_PASSWORD,
                newViewerPass || CONFIG.VIEWER_PASSWORD
            );

            if (success) {
                closeModal();
                showToast('Success', 'Passwords updated successfully', 'success');
                addActivity(currentUser, 'Changed system passwords');
                
                // फॉर्म रीसेट
                document.getElementById('currentAdminPass').value = '';
                document.getElementById('newAdminPass').value = '';
                document.getElementById('confirmAdminPass').value = '';
                document.getElementById('newViewerPass').value = '';
                document.getElementById('confirmViewerPass').value = '';
            } else {
                showToast('Error', 'Failed to save passwords', 'error');
            }
        }

        // ====================
        // LOGOUT FUNCTION
        // ====================
        function logout() {
            currentUser = null;
            currentUserRole = 'guest';
            document.getElementById('app').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('passwordInput').value = '';
            showToast('Logged Out', 'You have been logged out successfully.', 'info');
        }

        // ====================
        // INITIALIZATION
        // ====================
        document.addEventListener('DOMContentLoaded', function() {
            // पहले पासवर्ड लोड करें
            loadPasswords();
            
            // फिर डेटा लोड करें
            loadData();
            
            // लॉगिन इनिशियलाइजेशन
            document.getElementById('loginBtn').addEventListener('click', login);
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // पासवर्ड टॉगल
            document.getElementById('togglePassword').addEventListener('click', function() {
                const passwordInput = document.getElementById('passwordInput');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            });
            
            // ड्रॉपडाउन मेनू
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userDropdown = document.getElementById('userDropdown');
            
            if (userMenuBtn && userDropdown) {
                userMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    userDropdown.classList.toggle('hidden');
                });
                
                document.addEventListener('click', function(e) {
                    if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.classList.add('hidden');
                    }
                });
            }
            
            // Settings और Change Password बटन को role के अनुसार show/hide करें
            const settingsBtn = document.getElementById('settingsBtn');
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            
            if (settingsBtn) {
                settingsBtn.addEventListener('click', function() {
                    showSettingsModal();
                    userDropdown.classList.add('hidden');
                });
            }
            
            if (changePasswordBtn) {
                changePasswordBtn.addEventListener('click', function() {
                    showChangePasswordModal();
                    userDropdown.classList.add('hidden');
                });
            }
            
            // डेट टाइम अपडेट
            updateDateTime();
            setInterval(updateDateTime, 60000);
        });

        function updateDateTime() {
            const now = new Date();
            const dateTimeStr = now.toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }) + ' | ' + now.toLocaleTimeString('en-IN', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            
            document.getElementById('currentDateTime').textContent = dateTimeStr;
        }

        function login() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('errorMsg');
            
            if (password === CONFIG.ADMIN_PASSWORD) {
                currentUserRole = 'admin';
                currentUser = 'Admin';
                document.getElementById('userRole').textContent = 'Administrator';
                document.getElementById('userRoleText').textContent = 'Admin';
                document.getElementById('dropdownUserName').textContent = 'Admin User';
                document.getElementById('dropdownUserRole').textContent = 'Full Access';
                successfulLogin();
            } else if (password === CONFIG.VIEWER_PASSWORD) {
                currentUserRole = 'viewer';
                currentUser = 'Viewer';
                document.getElementById('userRole').textContent = 'View Only Mode';
                document.getElementById('userRoleText').textContent = 'Viewer';
                document.getElementById('dropdownUserName').textContent = 'Viewer User';
                document.getElementById('dropdownUserRole').textContent = 'Read Only Access';
                successfulLogin();
            } else {
                errorDiv.classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function successfulLogin() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('errorMsg').classList.add('hidden');
            
            updateUserInterface();
            showToast('Welcome Back!', `Logged in as ${currentUserRole === 'admin' ? 'Administrator' : 'Viewer'}`, 'success');
            addActivity(currentUser, `Logged into the system as ${currentUserRole}`);
        }

        // Make all necessary functions available globally
        window.logout = logout;
        window.showQuickPaymentModal = showQuickPaymentModal;
        window.saveQuickPayment = saveQuickPayment;
        window.showAddMemberModal = showAddMemberModal;
        window.saveNewMember = saveNewMember;
        window.showAllMembersView = showAllMembersView;
        window.showMonthlyReport = showMonthlyReport;
        window.viewMonthDetails = viewMonthDetails;
        window.showMessagingPanel = showMessagingPanel;
        window.selectAllWhatsAppMembers = selectAllWhatsAppMembers;
        window.deselectAllWhatsAppMembers = deselectAllWhatsAppMembers;
        window.loadMessageTemplate = loadMessageTemplate;
        window.generateWhatsAppLinksFixed = generateWhatsAppLinksFixed;
        window.showMainAccountWithdrawalModal = showMainAccountWithdrawalModal;
        window.processWithdrawal = processWithdrawal;
        window.showAllMembersEdit = showAllMembersEdit;
        window.editMember = editMember;
        window.saveMemberEdit = saveMemberEdit;
        window.toggleParkMember = toggleParkMember;
        window.markAsRetired = markAsRetired;
        window.deleteMember = deleteMember;
        window.showPaymentReports = showPaymentReports;
        window.showPendingPayments = showPendingPayments;
        window.showExcelExportOptions = showExcelExportOptions;
        window.exportMembersToExcel = exportMembersToExcel;
        window.exportPaymentsToExcel = exportPaymentsToExcel;
        window.exportCompleteData = exportCompleteData;
        window.downloadCSV = downloadCSV;
        window.showParkedMembers = showParkedMembers;
        window.exportDataForEmail = exportDataForEmail;
        window.showWithdrawalReports = showWithdrawalReports;
        window.showRetirementDetails = showRetirementDetails;
        window.showRetiredMembersDetails = showRetiredMembersDetails;
        window.showResetDataModal = showResetDataModal;
        window.performReset = performReset;
        window.showSettingsModal = showSettingsModal;
        window.showChangePasswordModal = showChangePasswordModal;
        window.changePassword = changePassword;
        window.closeModal = closeModal;
        window.recordPaymentForMember = recordPaymentForMember;
        window.savePayment = savePayment;
        window.toggleOtherDesignationInput = toggleOtherDesignationInput;
        window.toggleEditOtherDesignationInput = toggleEditOtherDesignationInput;
        window.filterAllMembersTable = filterAllMembersTable;
        window.resetAllMemberSearch = resetAllMemberSearch;
        window.quickFilterMembers = quickFilterMembers;
        window.filterRetiredMembers = filterRetiredMembers;

    </script>
</body>
</html>